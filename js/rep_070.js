function ExcelExport(n,t,i,r,u,f,e,o,s,h){var v,y,b,l,w,c;typeof i=="function"&&i.call();v=n.options;y=n.filter();y&&(v.filter=y,v.group=[]);b=new kendo.data.DataSource(v);console.log(v);l=f?$(f).data("kendoGrid").options.columns:grid.options.columns;h&&(l=l.filter(function(n){return h.indexOf(n.field)!=-1}));var p=u==null?0:u.length,k=[],a=[{cells:[]}];for(c=0;c<p;c++)a.push({cells:[{value:u[c],bold:!0}]}),k.push("A"+(c+1)+":J"+(c+1));for(w=[],c=0;c<l.length;c++)w.push({width:(typeof l[c].width=="string"?l[c].width.replace("px",""):l[c].width)*(s||1)}),a[0+p].cells.push({value:l[c].title,borderTop:{color:"#000",size:1},borderLeft:{color:"#000",size:1},borderRight:{color:"#000",size:1},borderBottom:{color:"#000",size:1},background:"#ccc",bold:!0});b.fetch(function(){var data=this.data(),i,rowIndex,j,calc,workbook;for(y&&(data=this.view()),console.log(data),i=0;i<data.length;i++)for(rowIndex=i+1+p,a.push({cells:[]}),j=0;j<l.length;j++)e&&(a[rowIndex].height=Math.ceil(data[i][e].length/45)*20||20),l[j].calc?(calc=l[j].calc.replace(new RegExp("data.","g"),"data[i]"),a[rowIndex].cells.push({value:eval(calc),borderTop:{color:"#000",size:1},borderLeft:{color:"#000",size:1},borderRight:{color:"#000",size:1},borderBottom:{color:"#000",size:1},wrap:!0})):a[rowIndex].cells.push({value:data[i][l[j].field],borderTop:{color:"#000",size:1},borderLeft:{color:"#000",size:1},borderRight:{color:"#000",size:1},borderBottom:{color:"#000",size:1},wrap:!0});workbook=new kendo.ooxml.Workbook({sheets:[{mergedCells:k,columns:w,title:o||"Лист 1",rows:a}]});kendo.saveAs({dataURI:workbook.toDataURL(),fileName:t});typeof r=="function"&&r.call()})}function columnDialogue(n){var t={field:"",title:"",width:"",template:""};return t.field="questionsAndAnswers",t.title="Диалог",t.width=40,t.template="#=("+n+' ? \'<div style="text-align: center"> <a class="k-button" id="questionsAndAnswers" title="Посмотреть диалог с исполнителем"><span class="k-icon k-i-table-align-top-center"><\/span><sup style="font-weight:800;"><\/sup><\/a><\/div>\' : \'\')#',t}function showQuestionsAndAnswers(n){n.preventDefault();var t=$("#grid").data("kendoGrid"),i=t.dataItem($(n.currentTarget).closest("tr"));window.open(serviceToolsUrl+"/demand/ShowAnswersAndFiles?nomer_demand="+i.NOMER_DEMAND,"_blank")}function refrashRow(n){var t={performer:dmRep_070.ID_PERFORMER,date_beg:$("#D_BEGIN").data("kendoDatePicker").value().toJSON(),date_end:$("#D_END").data("kendoDatePicker").value().toJSON(),status:"99",status_ext:n,$select:cProfileGridCut+",NOMER_DEMAND,ID_CLIENT,CL_MAIL,ID_PERFORMER,ID_DEMAND,DATE_CREATE,STATUS_DEMAND_TXT,STATUS_DEMAND,ROW_COLOR,NAME_CLIENT_FULL,NOTE_COMMENT,CL_SEARCH_CODE,CR_SEARCH_CODE,NAME_OBJECT_KUPSO,DATE_PLAN_END,ID_TEAM,ALARM,TYPE_MASTER_DEMAND,KOD_STATUS_DEMAND,PERFORMER_EMAIL,NAME_TEMPLATE_DEMAND,LINK_INTERNET,NAME_CLOSE"};jqService("/odata/Demands70",t,"get",!1,function(n){n.value.length>0&&(dataSource.pushUpdate(n.value),grid.refresh(),ExpandGroupToObject(grid,n.value[0]))})}function saveStateGroup(n){function i(n,r,u,f){for(var o,e=0;e<n.length;e++)n[e].items&&(o={parentName:r||null,parentUid:u||null,parentExpand:f||!0,uid:n[e].aggregates[n[e].field].uid,name:n[e].value,expand:$("[data-uid='"+n[e].aggregates[n[e].field].uid+"']").closest("td").attr("aria-expanded")=="true"},t.push(o),n[e].hasSubgroups&&i(n[e].items,n[e].value,n[e].aggregates[n[e].field].uid,$("[data-uid='"+n[e].aggregates[n[e].field].uid+"']").closest("td").attr("aria-expanded")=="true"))}var t=[],r=grid.dataSource.view();i(r);window[n]=t}function returnStateGroup(){function i(n,t){for(var u=[],r,f,i=0;i<n.length;i++)for(r=0;r<t.length;r++)n[i].parentName!=t[r].parentName||n[i].name!=t[r].name||n[i].checked||t[r].checked||!n[i].parentExpand||(n[i].checked=!0,t[r].checked=!0,f={parentName:n[i].parentName,uid:t[r].uid,name:n[i].name,expand:n[i].expand},u.push(f));return u}var n,t;if(saveStateGroup("stateGroupArrayCurrent"),n=i(stateGroupArray,stateGroupArrayCurrent),n.length>0)for(t=0;t<n.length;t++)n[t].expand?grid.expandRow($("[data-uid='"+n[t].uid+"']").closest("tr")):grid.collapseRow($("[data-uid='"+n[t].uid+"']").closest("tr"))}function spawnNotification(n,t,i){var r,u;i=i||"info";r={body:t,icon:i};"Notification"in window?Notification.permission==="granted"?u=new Notification(n,r):(kNotification.hide(),kNotification.show(t,i)):(kNotification.hide(),kNotification.show(t,i))}function spawnNotification(n,t){t=t||"info";kNotification.show(n,t)}function checkDelete(n){return statusMod&&n.ID_CREATOR==dmRep_070.ID_USER&&n.CHECK_DELETE==1}function IsColumnHidden(n){if(n=="STATUS_DEMAND")return!1;var t=cProfileGroup;return t.indexOf(n)!=-1?!0:!1}function setColumnUsers(){openKendoWindow("setColumnsUser",$("#dlgImages"),{idList:dmRep_070.IdListColumns,idRes:dmRep_070.WEB_ID,idProfile:dmRep_070.idProfile,idListContextMenu:dmRep_070.IdListContextMenu},"Профиль пользователя: "+bagModel.Title)}function columnsgrid(){for(var i=","+cProfileGrid+",",t=0,n=columns.length-1;n>=0;n--)i.indexOf(","+columns[n].field+",")==-1?columns.splice(n,1):t+=columns[n].width;for(k=minWidthGrid/t,t=0,n=0;n<columns.length;n++)columns[n].width=Math.floor(columns[n].width*k),t+=columns[n].width;for(n=0;n<columns.length;n++)if(columns[n].field=="NOTE"){columns[n].width=columns[n].width+(minWidthGrid-t);break}}function groupProfile(){var i,t,n;if(cProfileGroup!="null"){for(i=[],t=cProfileGroup.split(","),n=0;n<t.length;n++)i.push({field:t[n].trim().split(" ")[0],dir:t[n].trim().split(" ")[1]?t[n].trim().split(" ")[1].toLowerCase():"asc",aggregates:[{field:t[n].trim().split(" ")[0],aggregate:"count"}]});return i}}function newNZ(n){openKendoWindow("NewOrderMulti",$("#dlgImages"),{idDemand:n,gridObject:"grid"})}function checkEvents(){dsRefresh.read().then(function(){start=(new Date).getTime();end=(new Date).getTime()+Number(cProfileRefreshInt);pb.value(0);var n=dsRefresh.view();n.length>0&&SetFilter()})}function getTimeLeft(){return Math.ceil(((new Date).getTime()-start)/1e3)}function refreshGridInterval(){Number(cProfileRefreshInt)>0&&($("#filterBtn").removeClass("refBtn"),intervalID&&clearTimeout(intervalID),intervalID=setTimeout(function n(){checkEvents();intervalID=setTimeout(n,cProfileRefreshInt)},cProfileRefreshInt),pb.value(0),refreshBar&&clearInterval(refreshBar),refreshBar=setInterval(function(){pb.value(pb.value()+1)},1e3))}function enableContextMenu(n,t,i){dmRep_070.ID_PERFORMER==i.ID_PERFORMER?(t.enable($("#addCompletedWork").parent().parent()[0],!0),t.enable($("#changeServices").parent().parent()[0],!0)):(t.enable($("#addCompletedWork").parent().parent()[0],!1),t.enable($("#changeServices").parent().parent()[0],!1));dmRep_070.PostponementAccess&&i.STATUS_DEMAND=="н.з. В работе"||dmRep_070.PostponementAccess&&i.STATUS_DEMAND.indexOf("н.з. В ожидании")!=-1&&i.NAME_CLOSE&&i.NAME_CLOSE.indexOf("Поставлено в очередь работ")!=-1?t.enable($("#postponementSLA").parent().parent()[0],!0):t.enable($("#postponementSLA").parent().parent()[0],!1);i.STATUS_DEMAND=="н.з. В работе"?t.enable($("#approveTransferOfTerm").parent().parent()[0],!0):t.enable($("#approveTransferOfTerm").parent().parent()[0],!1);i.STATUS_DEMAND=="н.з. В работе"||i.STATUS_DEMAND=="н.з. Выдано"?t.enable($("#accessCloseNZ").parent().parent()[0],!0):t.enable($("#accessCloseNZ").parent().parent()[0],!1);n.PRIV_TMC==0&&t.enable($("#accessTMC").parent().parent()[0],!1);n.PRIV_CREATE_TEMP==0&&t.enable($("#accessCreateTemp").parent().parent()[0],!1);i.NAME_TEMPLATE_DEMAND=="VAMI-ФД-01 Заявка на внутренний перерасчёт бюджета проектов."?t.enable($("#VamiFD01").parent().parent()[0],!0):t.enable($("#VamiFD01").parent().parent()[0],!1);arrNZ.length===0&&(t.enable($("#massCloseNZ").parent().parent()[0],!1),t.enable($("#massNextStatus").parent().parent()[0],!1));statusEnd.indexOf(i.STATUS_DEMAND)==-1?t.enable($("#NZExecTrans").parent().parent()[0],!0):t.enable($("#NZExecTrans").parent().parent()[0],!1);dmRep_070.PostponementAccess&&i.STATUS_DEMAND.indexOf("н.з. В ожидании")!=-1?t.enable($("#changeCloseStatus").parent().parent()[0],!0):t.enable($("#changeCloseStatus").parent().parent()[0],!1)}function addSubMenu(n,t,i){var u=i.view(),f,r;if(u.length>0&&t.length>0)for(f=t[0].items.length,t[0].items.push({text:"<span>"+n+"<\/span>",encoded:!1}),t[0].items[f].items=[],r=0;r<u.length;r++)t[0].items[f].items.push({text:"<span data-code='3' data-id = "+u[r].ID_DICTIONARY+">"+u[r].NAME+"<\/span>",encoded:!1})}function getTemplates(n,t,i){var r=$.grep(dsContextMenu,function(n){return n.keyToConfigure=="003"}),u;r[0].items=[];u=dsKendo("/odata/Resources",function(){return{resKod:"RES_469",kod:"not exists",ID_DICTIONARY:2,empty:0,node:1,cursor:124,link:n,$select:"ID_DICTIONARY,NAME",$orderby:"NAME"}},!0);u.read().then(function(){addSubMenu("Шаблоны закрытия",r,u);var f=dsKendo("/odata/Resources",function(){return{resKod:"RES_469",kod:"exists",ID_DICTIONARY:2,empty:0,node:1,cursor:124,link:n,$select:"ID_DICTIONARY,NAME",$orderby:"NAME"}},!0);f.read().then(function(){addSubMenu("Шаблоны перевыставления НЗ",r,f);$("#gridMenu").data("kendoContextMenu").setOptions({dataSource:dsContextMenu});var n=$("#gridMenu").data("kendoContextMenu");enableContextMenu(i,n,t)})})}function getExecutors(n,t,i){var r=dsKendo("/odata/SelectDemand",function(){return{id_demand:n,$select:"ID_PERFORMER_DEPATMENT,ID_PERFORMER"}},!0);r.read().then(function(){var u=r.view(),n=dsKendo("/odata/Resources",function(){return{resKod:"RES_025",empty:0,node:1,cursor:116,link:u[0].ID_PERFORMER_DEPATMENT,$orderby:"NAME"}},!0);n.read().then(function(){var u=n.view(),f=$.grep(dsContextMenu,function(n){return n.keyToConfigure=="014"}),r,e;if(u.length>0&&f.length>0)for(f[0].items=[],r=0;r<u.length;r++)f[0].items.push({text:"<span data-code='14' data-id = "+u[r].ID_DICTIONARY+">"+u[r].NAME+"<\/span>",encoded:!1});$("#gridMenu").data("kendoContextMenu").setOptions({dataSource:dsContextMenu});e=$("#gridMenu").data("kendoContextMenu");enableContextMenu(i,e,t)})})}function getSolution(n,t,i){var r=dsKendo("/odata/SelectDemand",function(){return{id_demand:n,$select:"ID_PERFORMER_DEPATMENT,ID_PERFORMER"}},!0);r.read().then(function(){var u=r.view(),n=dsKendo("/odata/SolutionContextMenu",function(){return{idTeam:u[0].ID_PERFORMER_DEPATMENT}},!0);n.read().then(function(){var u=n.view(),f=$.grep(dsContextMenu,function(n){return n.keyToConfigure=="020"}),r,e;if(u.length>0&&f.length>0)for(f[0].items=[],r=0;r<u.length;r++)f[0].items.push({text:"<span data-code='20' data-id = "+u[r].ID+" data-time="+u[r].TIME+" title='"+u[r].HINT+"'>"+u[r].NAME+"<\/span>",encoded:!1});$("#gridMenu").data("kendoContextMenu").setOptions({dataSource:dsContextMenu});e=$("#gridMenu").data("kendoContextMenu");enableContextMenu(i,e,t)})})}function resizeTabAndGrid(){var t=$("#panelgrid"),n,i;t&&(t.height(Math.floor($("#top-panel").height()-(showExtPane?0:30))),n=$("#grid").data("kendoGrid"),n&&n.wrapper.is(":visible")&&(i=$("#grid"),i.height(Math.floor(t.height())),n.resize()))}function SetFilter(){var t=$("#grid").data("kendoGrid"),n;saveStateGroup("stateGroupArray");gridNZ.dataSource.data([]);gridDocs.dataSource.data([]);n=null;arrNZ=[];groupsort=groupProfile();n=$("#NOMER_DEMAND").val()|dmRep_070.search;$("#NOMER_DEMAND").val(n?n:"");dmRep_070.search=null;start=(new Date).getTime();end=(new Date).getTime()+Number(cProfileRefreshInt);lastrefresh=new Date;n?dataSource.read({status:"99",status_ext:n}):dataSource.read().then(function(){dataSource.group()});t._endlessPageSize=dataSource.pageSize()}function ClearInput(){var n=$("#STATUS").data("kendoButtonGroup"),t=$("#STATUS_EXT").data("kendoButtonGroup"),i=$("#date-switch").data("kendoMobileSwitch");$("#NOMER_DEMAND").val("");i.enable(!0);d_end.enable(!0);d_begin.enable(!0);n.enable(!0);t.enable(!0)}function setContractMinEnd(){var t=$("#D_BEGIN").data("kendoDatePicker"),n=$("#D_END").data("kendoDatePicker");t&&n&&(n.min(t.value()),n.max(setStartDate(t.value(),maxPeriod)),n.value()<n.min()?n.value(n.min()):n.value()>n.max()&&n.value(n.max()))}function translateTime(n){var t=n/60^0,i;return t?(i=n%60,i<10&&(i="0"+i),t<10&&(t="0"+t),n=String(t)+":"+i):(n==0&&(n="00"),n<10&&(n="0"+n),n="00:"+n),n}function toPaintRow(n,t){for(var u,r,i=0;i<n.length;i++)u=n[i].items!=undefined,u?toPaintRow(n[i].items,t):(r=n[i],r.ROW_COLOR!=null&&t.sender.tbody.find("[data-uid='"+r.uid+"']").attr("style","color:"+r.ROW_COLOR+";"))}function appointExecutor(n,t,i,r){var u=$("#confirm").kendoDialog({title:"Подтвердите назначение",content:'Вы хотите назначить "'+i.textContent+'"?',actions:[{text:"Назначить",primary:!0,action:function(){var i={ID_DEMAND:t.ID_DEMAND,ID_USER:n.ID_USER,ID_PERFORMER:r};jqService("/api/UpdateDemand",i,"POST",!0,function(n){n=="OK"?refrashRow(t.NOMER_DEMAND):kendo.alert(n)})}},{text:"Отменить",action:function(){this.close()}}]}).data("kendoDialog");u.open()}function addSolutionCntx(n,t,i){dialogVR=$("#dialogVR").kendoDialog({width:"400px",title:"Добавление выполненной работы",content:"<p>Работа: "+$(t).text()+"<\/p><p>Затрачено: <input id='timeWork' /><p>",closable:!0,modal:!0,visible:!1,open:function(){$("#timeWork").kendoMaskedTextBox({mask:"00:00",value:translateTime($(t).attr("data-time"))}).data("kendoMaskedTextBox")},actions:[{text:"Добавить",primary:!0,action:function(){var r={Action:"INS",idDemand:n.ID_DEMAND,idUser:dmRep_070.ID_USER,idTypeSolution:i,TimeWork:$("#timeWork").data("kendoMaskedTextBox").value().replace(":",","),DateBegin:(new Date).toJSON()};jqService("/api/Demands/AddTypeSolution",r,"POST",!0,function(n){n.MESS=="OK"?kNotification.show(" Выполненная работа: "+$(t).text()+" добавлена","info"):kNotification.show(" Произошла ошибка при добавлении ВР","error")})}},{text:"Отменить",action:function(){this.close()}}]}).data("kendoDialog");dialogVR.open()}function FillInGridMatching(){jqService("/odata/DemandDocs",{demand:nomer_demand,file_ext:".json"},"GET",!0,function(n){for(var i=n.value,r,u,f,t=0;i.length>t;t++)if(u=/Route_\d+.json/,f=u.exec(i[t].FILE_EXT),f!=null){r=i[t];break}r!=null?jqService("/api/DocBody",{pIdDoc:r.ID_DOC},"GET",!0,function(n){var i,r,t;if(n.RouteSteps!=null){for(i=n.RouteSteps,r=[],t=0;i.length>t;t++)i[t].Person!=null&&r.push({DATE_CREATE:i[t].DecisionDate,NAME:i[t].Person.FullName,COMMENT:i[t].Comment,FILES:JSON.stringify(i[t].Files)});gridMatching.dataSource.data(r)}}):gridMatching.dataSource.data([])})}function myconfirm(n,t){return $("<div><\/div>").kendoConfirm({title:n,content:t}).data("kendoConfirm").open().result}function createListFiles(n){var t=JSON.parse(n),r="",i;if(t.length>0)for(console.log(t),i=0;t.length>i;i++)r=r+"<div style='display:flex;margin:auto;' title='"+t[i].Name+"'><a href=\""+t[i].Url+'"><img src="'+actionContent+"/web/ExtFile/"+t[i].Name.split(".").pop()+'.png" onerror="this.onerror=null;this.src=\''+actionContent+'/web/ExtFile/общ.png\';" style="max-width:24px;"/><\/a><\/div>';return console.log(r),r}function mobileListView(){}var grid,IdTeam,selectrow,intervalID,refreshBar,start,end,lastrefresh,pb,groupsort,k=1,minWidthGrid=1280,maxPeriod=30,cProfileGrid=dmRep_070.ProfileGrid,cProfileGroup=dmRep_070.ProfileGroup,cProfileContextMenu=dmRep_070.ProfileContextMenu,cProfileRefreshInt=dmRep_070.ProfileRefreshInt,cProfilePeriod=dmRep_070.ProfilePeriod,cProfilefilterSetting,cProfileFormSetting,showExtPane=dmRep_070.showExtPane,d_end,d_begin,statusNew,tmpFilterData=[],allExecutor=!1,kNotification=$("#notification").kendoNotification({autoHideAfter:0}).data("kendoNotification"),getAllExecutor,fontSize,range,tmpColArr,columns;idleTime=0;allExecutor=!1;prevSelectRow=null;selectedRow=null;idRes_001_970_955_01=null;idRes_490=null;type_close=26591;statusMod=!1;nomer_demand=0;dialogVR=null;idRes_400_62=null;statusEnd=["н.з. Выполнено","н.з. Отклонено"];var groupCol=[],arrNZ=[],test,idRes_791_70_001=null,idRes_791_70_001_DOC=null,idRes_791_70_002=null,idRes_791_70_002_DOC=null,idRes_791_70_004=null,idRes_791_70_004_DOC=null,colorNoDelete="#ccc",colorDeleteActive="#fff",colorDeleteNoActive="#515967",uploadData={ID_DOC:-1,NOMER_DEMAND:0,DATE_CREATE:(new Date).toJSON(),FILE_EXT:"test.txt",NOTE:"web",ID_CREATOR:dmRep_070.ID_USER,TYPE_CLOSE:0,NAME_CREATOR:"",DOC_LENGTH:"0"},gridDocs,gridNZ,colurList=[{Name:"Удалить",Id:0,color:"#D3D3D3"},{Name:"Красный",Id:1,Class:"firstColor",color:"#FF0000"},{Name:"Оранжевый",Id:2,Class:"secondColor",color:"#FFA500"},{Name:"Желтый",Id:3,Class:"thirdColor",color:"#FFFF00"},{Name:"Зеленый",Id:4,Class:"fourthColor",color:"#008000"},{Name:"Голубой",Id:5,Class:"fifthColor",color:"#0000FF"}],stateGroupArray=[],stateGroupArrayCurrent=[];"Notification"in window&&Notification.requestPermission().then(function(){});SetClientProfile(dmRep_070.ID_CLIENT,dmRep_070.WEB_ID);getAllExecutor=findForInternetExplorer("ID_DICTIONARY",cProfileFormSetting,dmRep_070.idAllExecutorSetting,"NOTE");getAllExecutor!=undefined&&typeof JSON.parse(getAllExecutor)=="boolean"&&(allExecutor=JSON.parse(getAllExecutor));fontSize=findForInternetExplorer("ID_DICTIONARY",cProfileFormSetting,dmRep_070.idFontSizeSetting,"NOTE");fontSize==null||fontSize==0||isNaN(Number(fontSize))||$("Body").css("font-size",Number(fontSize));showExtPane=findForInternetExplorer("ID_DICTIONARY",cProfileFormSetting,193418,"NOTE")=="true";cProfileRefreshInt=findForInternetExplorer("ID_DICTIONARY",cProfileFormSetting,dmRep_070.idProfileRefres,"NOTE")*minute;range=findForInternetExplorer("ID_DICTIONARY",cProfilefilterSetting,dmRep_070.idDateRangeSetting,"NOTE");cProfilePeriod=range!=null&&range!=0&&Number(range)?range:cProfilePeriod=="null"?30:Math.min(cProfilePeriod,maxPeriod);tmpColArr=cProfileGrid.split(",");var cProfileGridCut=cProfileGrid.replace(",questionsAndAnswers",""),dataSource=new kendo.data.DataSource({type:"odata-v4",page:1,serverPaging:!1,serverFiltering:!1,serverSorting:!1,editable:!1,group:groupProfile(),sort:groupsort?groupsort:[{field:"DATE_PLAN_END",dir:"asc"}],transport:{read:{url:serviceRoot+"/odata/Demands70",data:function(){var n=$("#NOMER_DEMAND").val()|dmRep_070.search;return{performer:dmRep_070.ID_PERFORMER||-1,date_beg:$("#D_BEGIN").data("kendoDatePicker").value().toJSON(),date_end:$("#D_END").data("kendoDatePicker").value().toJSON(),status:n?99:statusNew?statusNew:$("#STATUS").data("kendoButtonGroup").current()[0].getAttribute("data-value"),status_ext:n?n:$("#STATUS_EXT").data("kendoButtonGroup").current()[0].getAttribute("data-value"),status_3:$("#STATUS_3").data("kendoButtonGroup").current()[0].getAttribute("data-value"),$select:cProfileGridCut+",NOMER_DEMAND,ID_CLIENT,CL_MAIL,ID_PERFORMER,ID_DEMAND,DATE_CREATE,STATUS_DEMAND_TXT,STATUS_DEMAND,ROW_COLOR,NAME_CLIENT_FULL,NOTE_COMMENT,CL_SEARCH_CODE,CR_SEARCH_CODE,NAME_OBJECT_KUPSO,DATE_PLAN_END,ID_TEAM,ALARM,TYPE_MASTER_DEMAND,KOD_STATUS_DEMAND,PERFORMER_EMAIL,NAME_TEMPLATE_DEMAND,LINK_INTERNET,NAME_CLOSE"}},dataType:"json",contentType:"application/json",type:"GET",xhrFields:{withCredentials:!0}}},requestEnd:SetGridDateOffset,schema:{model:{id:"ID_DEMAND",fields:{NOMER_DEMAND:{editable:!1,type:"decimal"},NAME_CLIENT:{editable:!1,type:"string"},CL_SEARCH_CODE:{editable:!1,type:"string"},FIO_CREATOR:{editable:!1,type:"string"},CR_SEARCH_CODE:{editable:!1,type:"string"},LINK_INTERNET:{editable:!1,type:"string"},NOTE:{editable:!1,type:"string"},NAME_TEMPLATE_DEMAND:{editable:!1,type:"string"},NAME_GROUP_WORK:{editable:!1,type:"string"},DATE_BEGIN:{editable:!1,type:"date"},DATE_CREATE:{editable:!1,type:"date"},DATE_PLAN_BEGIN:{editable:!1,type:"date"},DATE_PLAN_END:{editable:!1,type:"date"},NAME_TEAM:{editable:!1,type:"string"},SHORT_NAME_TEAM:{editable:!1,type:"string"},NAME_PERFORMER:{editable:!1,type:"string"},PERFORMER_EMAIL:{editable:!1,type:"string"},STATUS_DEMAND:{editable:!1,type:"string"},ID_PERFORMER:{editable:!1,type:"string"},ID_DEMAND:{editable:!1,type:"decimal"},NOTE_COMMENT:{editable:!1,type:"string"},NAME_CLOSE:{editable:!1,type:"string"},KOD_STATUS_NO:{editable:!1,type:"decimal"},DAY_PLAN_END:{editable:!1,type:"string"},NAME_OBJECT_KUPSO:{editable:!1,type:"string"},NAME_CATALOG_SERVICES:{editable:!1,type:"string"},NAME_CONTRACTOR:{editable:!1,type:"string"},NAME_GROUP_ACCESS:{editable:!1,type:"string"},NAME_STATUS_DEMAND:{editable:!1,type:"string"},TYPE_MASTER_DEMAND:{editable:!1,type:"decimal"},ATTR_EXT_01:{editable:!1,type:"string"},ATTR_EXT_02:{editable:!1,type:"string"},ALARM:{editable:!1,type:"decimal"}}}}}),dsRefresh=new kendo.data.DataSource({type:"odata-v4",transport:{read:{url:serviceRoot+"/odata/Demands70",data:function(){return{performer:dmRep_070.ID_PERFORMER,date_beg:$("#D_BEGIN").data("kendoDatePicker").value().toJSON(),date_end:$("#D_END").data("kendoDatePicker").value().toJSON(),status:statusNew?statusNew:$("#STATUS").data("kendoButtonGroup").current()[0].getAttribute("data-value"),status_ext:$("#STATUS_EXT").data("kendoButtonGroup").current()[0].getAttribute("data-value"),status_3:$("#STATUS_3").data("kendoButtonGroup").current()[0].getAttribute("data-value"),$select:"ID_DEMAND,NOMER_DEMAND",$filter:"DATE_CREATE ge "+lastrefresh.toJSON()}},dataType:"json",contentType:"application/json",type:"GET",xhrFields:{withCredentials:!0}}},schema:{model:{id:"NOMER_DEMAND",fields:{NOMER_DEMAND:{editable:!1,type:"string"}}}}}),dsEmployee=new kendo.data.DataSource({type:"odata-v4",page:1,serverPaging:!1,serverFiltering:!1,serverSorting:!1,editable:!1,transport:{read:{url:serviceRoot+"/odata/NzFromDemand",data:function(){return{nomer_demand:0}},dataType:"json",contentType:"application/json",type:"GET",xhrFields:{withCredentials:!0}}},schema:{model:{id:"ID_DEMAND",fields:{DATE_CREATE:{editable:!1,type:"date"},NAME_CREATOR:{editable:!1,type:"string"},NAME_PERFORMER:{editable:!1,type:"string"},NOTE_COMMENT:{editable:!1,type:"string"},STATUS_DEMAND_TXT:{editable:!1,type:"string"}}}}}),dsDocs=new kendo.data.DataSource({type:"odata-v4",page:1,serverPaging:!0,serverFiltering:!0,serverSorting:!0,editable:!1,transport:{read:{url:serviceRoot+"/odata/DemandDocs",data:function(){return{demand:0,file_ext:"*.*",$orderby:"DATE_CREATE desc"}},dataType:"json",contentType:"application/json",type:"GET",xhrFields:{withCredentials:!0}}},schema:{model:{id:"ID_DOC",fields:{ID_DOC:{editable:!1,type:"decimal"},NOMER_DEMAND:{editable:!1,type:"string"},DATE_CREATE:{editable:!1,type:"date"},FILE_EXT:{editable:!1,type:"string"},NOTE:{editable:!1,type:"string"},ID_CREATOR:{editable:!1,type:"decimal"},TYPE_CLOSE:{editable:!1,type:"decimal"},NAME_CREATOR:{editable:!1,type:"string"},DOC_LENGTH:{editable:!1,type:"decimal"},CHECK_DELETE:{editable:!1,type:"decimal"}}}}});$(window).load(function(){resizeTabAndGrid();$(window).resize(function(){setTimeout(function(){resizeTabAndGrid()},500)})});dmRep_070.PostponementAccess&&($("#colorChooser").kendoColorPalette({palette:colurList.map(function(n){return n.color}),tileSize:20,clearButton:!0,value:"#ffcc33",change:function(){var t=this.value().toUpperCase(),n=colurList.filter(function(n){return n.color.toUpperCase()==t})[0].Id,i={ID_DEMAND:selectedRow.ID_DEMAND,ID_USER:dmRep_070.ID_USER,COUNT_MATERIAL:n==0?-1:n};jqService("/api/UpdateDemand",i,"POST",!0,function(n){n=="OK"?refrashRow(selectedRow.NOMER_DEMAND):kendo.alert(n)})}}),$("#ColorMenu").kendoContextMenu({target:"#grid",filter:"div.countMaterialOrb",animation:{open:{effects:"fadeIn"},duration:500},open:function(n){selectedRow=grid.dataItem($(n.target).parent().parent().parent())}}));$(document).ready(function(){function f(n){nomer_demand>0&&$(n.item).attr("data-grid")=="dsEmployee"?(dsEmployee.read({nomer_demand:nomer_demand}),setTimeout(function(){gridNZ.refresh()},500)):nomer_demand>0&&$(n.item).attr("data-grid")=="dsDocs"?(dsDocs.read({demand:nomer_demand}),setTimeout(function(){gridDocs.refresh()},500)):nomer_demand>0&&$(n.item).attr("data-grid")=="dsMatching"&&FillInGridMatching()}function e(n){uploadData.DATE_CREATE=(new Date).toJSON();n.sender.options.async.saveUrl=serviceToolsUrl+"/Upload/save?Data="+JSON.stringify(uploadData)}function o(){$(".k-upload-files.k-reset").find("li").remove();dsDocs.read({demand:nomer_demand})}function h(n){var t=$("#grid").data("kendoGrid");return t.dataItem($(n.currentTarget).closest("tr"))}function c(n){n.preventDefault();var i=$("#DOCS").data("kendoGrid"),t=i.dataItem($(n.currentTarget).closest("tr"));t&&span_delete.css("pointer-events")=="auto"&&confirm("Удалить документ?")&&jqService1("/odata/DemandDocs?IdDoc="+t.ID_DOC+"&IdUser="+dmRep_070.ID_USER,"","delete",!0,function(n){this.value?showMessage("Ошибка",n.value):dsDocs.read({demand:nomer_demand})})}function l(n){n.preventDefault();var i=$("#grid").data("kendoGrid"),t=i.dataItem($(n.currentTarget).closest("tr"));t&&typeof t.ID_PERFORMER!="undefined"&&openKendoWindow("status",$("#dlgImages"),{idDemand:t.ID_DEMAND},"№"+t.NOMER_DEMAND+"- смена статуса - Наряд-Задание ["+t.STATUS_DEMAND+"] c "+GetDate(t.DATE_CREATE))}function a(n){n.preventDefault();var i=$("#grid").data("kendoGrid"),t=i.dataItem($(n.currentTarget).closest("tr"));t&&typeof t.ID_PERFORMER!="undefined"&&openKendoWindow("HistoryDemand",$("#dlgImages"),{nomerDemand:t.NOMER_DEMAND},"Информация по заявке №"+t.NOMER_DEMAND)}function v(n){n.preventDefault();var i=$("#grid").data("kendoGrid"),t=i.dataItem($(n.currentTarget).closest("tr"));t&&typeof t.ID_PERFORMER!="undefined"&&openKendoWindow("filterableHistoryDemand",$("#dlgImages"),{nomerDemand:t.NOMER_DEMAND},"Информация по заявке №"+t.NOMER_DEMAND)}function y(n){n.preventDefault();var i=$("#grid").data("kendoGrid"),t=i.dataItem($(n.currentTarget).closest("tr"));t&&typeof t.ID_PERFORMER!="undefined"&&openKendoWindow("HistoryTree",$("#dlgImages"),{nomer_demand:t.NOMER_DEMAND},"ЖЦ Заявки №"+t.NOMER_DEMAND)}function p(n){n.preventDefault();var i=$("#grid").data("kendoGrid"),t=i.dataItem($(n.currentTarget).closest("tr"));t&&typeof t.ID_PERFORMER!="undefined"&&openKendoWindow("Upload/DemandDocs",$("#dlgImages"),{idDemand:t.ID_DEMAND},"Документы по №"+t.NOMER_DEMAND)}function w(n){n.preventDefault();var i=$("#grid").data("kendoGrid"),t=i.dataItem($(n.currentTarget).closest("tr"));t&&typeof t.ID_PERFORMER!="undefined"&&openKendoWindow("CompletedWork",$("#dlgImages"),{idDemand:t.ID_DEMAND,moduleName:"AddWork"},"Добавление/просмотр выполненных работа по з. № "+t.NOMER_DEMAND)}function b(n){n.preventDefault();var i=$("#grid").data("kendoGrid"),t=i.dataItem($(n.currentTarget).closest("tr"));t&&typeof t.ID_PERFORMER!="undefined"&&openKendoWindow("EditNoteNZ",$("#dlgImages"),{idDemand:t.ID_DEMAND})}var u,s;$("#vertical").kendoSplitter({orientation:"vertical",panes:[{collapsible:!1,resizable:!0,size:"70%"},{collapsible:!1,resizable:!0,collapsed:!showExtPane,size:"30%"}],collapse:function(){setTimeout(function(){resizeTabAndGrid()},0)},expand:function(){setTimeout(function(){resizeTabAndGrid()},0)},resize:function(){setTimeout(function(){resizeTabAndGrid()},0)}});$("#tabstrip").kendoTabStrip({animation:{open:{effects:"fade"}},select:f});columnsgrid();u=0;setTimeout(function(){var n=0,t=function(){menu=$("#gridMenu").kendoContextMenu({orientation:"vertical",target:"#grid",filter:"tr[role='row']",animation:{open:{effects:"fadeIn"},duration:500},open:function(t){var f;$("#gridCopyMenu").data("kendoContextMenu").close();var e=this,r=$("#grid").data("kendoGrid"),i=r.dataItem(t.target);(r.select().length==0||r.select()[0].dataset.uid!=i.uid)&&r.select("tr[data-uid='"+i.uid+"']");u!=i.ID_TEAM&&n==0?(u=i.ID_TEAM,getExecutors(i.ID_DEMAND,i,access),getTemplates(i.ID_TEAM,i,access),getSolution(i.ID_DEMAND,i,access),n=1):enableContextMenu(access,e,i);f=t.item;setTimeout(function(){var n=$(f).find(".k-i-loading");n.removeClass("k-i-loading")},100)},close:function(){n=0},select:function(n){var l=$("#grid").data("kendoGrid"),t=l.dataItem(n.target),f=$(n.item).children(".k-link").text(),a=Number($(n.item).children(".k-link")[0].getElementsByTagName("span")[0].getAttribute("data-code")),c,e,r,o,s,h,i,u;switch(a){case 1:openKendoWindow("status",$("#dlgImages"),{idDemand:t.ID_DEMAND},"№"+t.NOMER_DEMAND+"- смена статуса - Наряд-Задание ["+t.STATUS_DEMAND+"] c "+GetDate(t.DATE_CREATE));break;case 2:openKendoWindow("CompletedWork",$("#dlgImages"),{idDemand:t.ID_DEMAND,moduleName:"AddWork",allExecutor:allExecutor},"Добавление/просмотр выполненных работа по з. № "+t.NOMER_DEMAND);break;case 3:c=$(n.item).children(".k-link")[0].getElementsByTagName("span")[0].getAttribute("data-id");openKendoWindow("CloseNzTemplate",$("#dlgImages"),{idDemand:t.ID_DEMAND,idTemplate:parseInt(c),newPerformerId:dmRep_070.ID_PERFORMER});break;case 4:openKendoWindow("NewOrderMulti",$("#dlgImages"),{idDemand:t.ID_DEMAND,gridObject:"grid"});break;case 5:openKendoWindow("HistoryDemand",$("#dlgImages"),{nomerDemand:t.NOMER_DEMAND},"Информация по заявке №"+t.NOMER_DEMAND);break;case 6:openKendoWindow("Upload/DemandDocs",$("#dlgImages"),{idDemand:t.ID_DEMAND},"Документы по №"+t.NOMER_DEMAND);break;case 7:openKendoWindow("AddNormaNZ",$("#dlgImages"),{idDemand:t.ID_DEMAND});break;case 8:openKendoWindow("HistoryTree",$("#dlgImages"),{nomer_demand:t.NOMER_DEMAND},"ЖЦ Заявки №"+t.NOMER_DEMAND);break;case 9:openKendoWindow("EditNoteNZ",$("#dlgImages"),{idDemand:t.ID_DEMAND});break;case 10:openKendoWindow("AddTMC",$("#dlgImages"),{idDemand:t.ID_DEMAND});break;case 11:openKendoWindow("CreateDemandTempl",$("#dlgImages"),{id_res:142586,nomer_demand:t.NOMER_DEMAND,idDemand:t.ID_DEMAND});break;case 12:openKendoWindow("CreateDemandTemplNew",$("#dlgImages"),{id_res:142586,nomer_demand:t.NOMER_DEMAND,idDemand:t.ID_DEMAND});break;case 13:openKendoWindow("createPostponement",$("#dlgImages"),{nomerDemand:t.NOMER_DEMAND});break;case 14:r=$(n.item).children(".k-link")[0].getElementsByTagName("span")[0];e=r.getAttribute("data-id");t.ID_DEMAND!=null&&r!=null&&e!=null&&appointExecutor(dmRep_070,t,r,e,dataSource);break;case 20:r=$(n.item).children(".k-link")[0].getElementsByTagName("span")[0];o=r.getAttribute("data-id");t.ID_DEMAND!=null&&r!=null&&o!=null&&addSolutionCntx(t,r,o);break;case 21:openKendoWindow("StatusExecTrans",$("#dlgImages"),{idDemand:t.ID_DEMAND,modal:1});break;case 23:openKendoWindow("approveTransferOfTerm",$("#dlgImages"),{idDemand:t.ID_DEMAND});break;case 151:openKendoWindow("changeDemandAttribute",$("#dlgImages"),{nameAttr:"TYPE_TEMPLATE_DEMAND",resCod:"RES_050",idDemand:t.ID_DEMAND,idUser:dmRep_070.ID_CLIENT,nameParameter:"TYPE_CATALOG_SERVICES",oldValue:"TYPE_CATALOG_SERVICES",node:2},"Смена сервиса");break;case 152:openKendoWindow("addOrUpdateExtraAttribute",$("#dlgImages"),{resCod:"RES_036",idDemand:t.ID_DEMAND,nomerDemand:t.NOMER_DEMAND,idUser:dmRep_070.ID_CLIENT,node:0},"ДобавлениеРедактирование ОЕ");break;case 153:idRes_001_970_955_01=idRes_001_970_955_01==null?jqService("/api/Resource/ResIdByKod",{reskod:"001",kod:"970.955.01"}):idRes_001_970_955_01;s=jqService("/api/FindResTypeAttr",{resid:t.ID_TEAM,attrid:idRes_001_970_955_01});s==null?kendo.alert("На вашу команду не настроенна такая функция"):(idRes_490=idRes_490==null?jqService("/api/Resource/ResId",{reskod:"490"}):idRes_490,h=jqService("/api/FindResTypeAttr",{resid:s,attrid:idRes_490}),h==null?kendo.alert("Не настроен тип проблем"):openKendoWindow("addAndDeleteExtraAttributes",$("#dlgImages"),{resCod:"RES_490",dictionaryId:h,nomerDemand:t.NOMER_DEMAND,idUser:dmRep_070.ID_CLIENT,node:0},"Добавление типа проблем"));break;case 154:openKendoWindow("EditService",$("#dlgImages"),{resCod:"RES_401",cursor:117,node:1,link:7596,idDemand:t.ID_DEMAND,nomerDemand:t.NOMER_DEMAND,idUser:dmRep_070.ID_USER},"Смена уточняющего статуса");break;case 161:i=t.NOMER_DEMAND;copyTextToClipboard(i);break;case 162:i=jqService("/api/Demands/DemandInfo",{IdDemand:t.ID_DEMAND,type:1});copyTextToClipboard(i);break;case 163:i=t.NAME_CLIENT_FULL;copyTextToClipboard(i);break;case 164:i=t.NOTE_COMMENT;copyTextToClipboard(i);break;case 165:i=t.LINK_INTERNET==null?"URL не назначен":t.LINK_INTERNET;copyTextToClipboard(i);break;case 166:i=[t.NOMER_DEMAND,jqService("/api/Demands/DemandInfo",{IdDemand:t.ID_DEMAND,type:1}),t.NAME_CLIENT_FULL,t.NOTE_COMMENT,t.LINK_INTERNET].join(" ");copyTextToClipboard(i);break;case 17:openKendoWindow("AddCompletedWork",$("#dlgImages"),{idDemand:t.ID_DEMAND,moduleName:"AddCompletedWork",successFunction:"close"},"Добавление выполненной работу по з. № "+t.NOMER_DEMAND);break;case 18:arrNZ.length>1&&(kNotification.hide(),u={IdUser:dmRep_070.ID_USER},myconfirm("Автоматическое закрытие НЗ",f+": <b>"+arrNZ.length+"<\/b>").done(function(){for(var t=[],n=0;n<arrNZ.length;n++)u.IdDemand=arrNZ[n].ID_DEMAND,u.IdTemplate=arrNZ[n].ID_TEMPL,t.push(jqService("/api/Demands/CloseNzTemplate",u,"POST"));t.map(function(n){return n.MESS}).filter(function(n){return n=="OK"}).length===arrNZ.length?(kNotification.show(arrNZ.length+" Наряд-задания успешно закрыты!","info"),arrNZ=[]):kNotification.show(" Не все наряд-задания успешно закрыты!","error");SetFilter();arrNZ=[]}).fail(function(){kNotification.show(" Отмена операции: "+f,"error")}));break;case 191:idRes_791_70_001=idRes_791_70_001==null?jqService("/api/Resource/ResIdByKod",{reskod:"791",kod:"70.001"}):idRes_791_70_001;idRes_791_70_001_DOC=idRes_791_70_001_DOC==null?jqService("/odata/EntityDocs",{id:idRes_791_70_001,file_ext:"*.html",entity:"PA_RESOURSE_DOC"}).value[0].ID_DOC:idRes_791_70_001_DOC;openKendoWindow("reportsExpendableMaterials",$("#dlgImages"),{nomerDemand:t.NOMER_DEMAND,fileId:idRes_791_70_001_DOC});break;case 192:idRes_791_70_002=idRes_791_70_002==null?jqService("/api/Resource/ResIdByKod",{reskod:"791",kod:"70.002"}):idRes_791_70_002;idRes_791_70_002_DOC=idRes_791_70_002_DOC==null?jqService("/odata/EntityDocs",{id:idRes_791_70_002,file_ext:"*.html",entity:"PA_RESOURSE_DOC"}).value[0].ID_DOC:idRes_791_70_002_DOC;openKendoWindow("reportsTechnicalStatusOfMean",$("#dlgImages"),{nomerDemand:t.NOMER_DEMAND,fileId:idRes_791_70_002_DOC});break;case 193:idRes_791_70_004=idRes_791_70_004==null?jqService("/api/Resource/ResIdByKod",{reskod:"791",kod:"70.004"}):idRes_791_70_004;idRes_791_70_004_DOC=idRes_791_70_004_DOC==null?jqService("/odata/EntityDocs",{id:idRes_791_70_004,file_ext:"*.html",entity:"PA_RESOURSE_DOC"}).value[0].ID_DOC:idRes_791_70_004_DOC;openKendoWindow("reportsVamiFD01",$("#dlgImages"),{idDemand:t.ID_DEMAND,fileId:idRes_791_70_004_DOC});break;case 22:arrNZ.length>1&&(kNotification.hide(),idRes_400_62=idRes_400_62==null?jqService("/api/Resource/ResIdByKod",{reskod:"400",kod:"62"}):idRes_400_62,u={IdUser:dmRep_070.ID_USER,IdTypeDemand:7594,IdTypeClose:null,IdPerformer:dmRep_070.ID_PERFORMER,NoteComment:null,MailSend:0},myconfirm("Автоматическое изменение статуса",f+": <b>"+arrNZ.length+"<\/b>").done(function(){for(var t=[],n=0;n<arrNZ.length;n++)u.IdDemand=arrNZ[n].ID_DEMAND,t.push(jqService("/api/Demands/NextDemandStatus",u,"POST"));t.map(function(n){return n.MESS}).filter(function(n){return n=="OK"}).length===arrNZ.length?(kNotification.show(arrNZ.length+" Наряд-задания успешно переведены!","info"),arrNZ=[]):kNotification.show(" Не все наряд-задания успешно переведены!","error");SetFilter();arrNZ=[]}).fail(function(){kNotification.show(" Отмена операции: "+f,"error")}))}},dataSource:dsContextMenu})},i=function(){menu=$("#gridCopyMenu").kendoContextMenu({orientation:"vertical",target:"#grid",filter:"td[data-CopyMenu='true']",animation:{open:{effects:"fadeIn"},duration:500},open:function(n){$("#gridMenu").data("kendoContextMenu").close();var r=this,t=$("#grid").data("kendoGrid"),i=t.dataItem($(n.target).parent());(t.select().length==0||t.select()[0].dataset.uid!=i.uid)&&t.select("tr[data-uid='"+i.uid+"']")},select:function(n){var r=$("#grid").data("kendoGrid"),i=r.dataItem($(n.target).parent()),f=$(n.item).children(".k-link").text(),u=Number($(n.item).children(".k-link")[0].getElementsByTagName("span")[0].getAttribute("data-code")),t;switch(u){case 1:t=i.NOMER_DEMAND;copyTextToClipboard(t);break;case 2:t=jqService("/api/Demands/DemandInfo",{IdDemand:i.ID_DEMAND,type:1});copyTextToClipboard(t);break;case 3:t=i.NAME_CLIENT_FULL;copyTextToClipboard(t);break;case 4:t=i.NOTE_COMMENT;copyTextToClipboard(t);break;case 5:t=i.LINK_INTERNET==null?"URL не назначен":i.LINK_INTERNET;copyTextToClipboard(t);break;case 6:t=[i.NOMER_DEMAND,jqService("/api/Demands/DemandInfo",{IdDemand:i.ID_DEMAND,type:1}),i.NAME_CLIENT_FULL,i.NOTE_COMMENT,i.LINK_INTERNET].join(" ");copyTextToClipboard(t)}},dataSource:dsCopyContextMenu})};i();t()},0);grid=$("#grid").kendoGrid({toolbar:[{template:kendo.template($("#template").html())},{name:"excel",text:""}],excel:{fileName:bagModel.Title+".xlsx",filterable:!0,allPages:!0},groupable:!0,reorderable:!0,resizable:!0,sortable:{mode:"multiple",allowUnsort:!0,showIndexes:!0},group:function(n){var r=$("#grid").data("kendoGrid"),i,t;if(dataSource._sort=n.groups.length?n.groups:[{field:"DATE_PLAN_END",dir:"asc"}],groupCol=[],n.groups.length>0)for(t=0;t<n.groups.length;t++)groupCol.push(n.groups[t].field);for(i=0;i<tmpColArr.length;i++)grid.showColumn(tmpColArr[i]);if(groupCol.length>0)for(tmparr=cProfileGrid.split(","),t=0;t<groupCol.length;t++)groupCol[t]!="STATUS_DEMAND"&&grid.hideColumn(groupCol[t]);$("#grid table[role=grid]").removeAttr("style")},autoBind:!1,dataSource:dataSource,change:function(){var r,n,i,t;for(selectrow=this.dataItem(this.select().closest("tr")),nomer_demand=selectrow.NOMER_DEMAND,uploadData.NOMER_DEMAND=selectrow.NOMER_DEMAND,r=[],n=this.select(),$("td #NOM_DEMAND").css("color","#1984c8"),$(".k-state-selected td #NOM_DEMAND").css("color","#000"),$("td #NOM_DEMAND_HIST").css("color","#1984c8"),$(".k-state-selected td #NOM_DEMAND_HIST").css("color","#000"),$("td #icon_solution").css("color","#1984c8"),$(".k-state-selected td #icon_solution").css("color","#fff"),$("td #icon_docs").css("color","#1984c8"),$(".k-state-selected td #icon_docs").css("color","#fff"),$("td #icon_color").css("color","#1984c8"),$(".k-state-selected td #icon_color").css("color","#fff"),$("td #icon_status").css("color","#1984c8"),$(".k-state-selected td #icon_status").css("color","#fff"),$("td #icon_status_other").css("color","#1984c8"),$(".k-state-selected td #icon_status_other").css("color","#fff"),n.hasClass("newRows")&&n.hasClass("k-state-selected")&&n.removeClass("newRows"),n.hasClass("greenRows")&&n.hasClass("k-state-selected")&&(n.removeClass("greenRows"),prevSelectRow&&(prevSelectRow.attr("id")!="rows_alarm_green"||prevSelectRow.hasClass("k-state-selected")?prevSelectRow.attr("id")!="rows_alarm_red"||prevSelectRow.hasClass("k-state-selected")||prevSelectRow.addClass("redsRows"):prevSelectRow.addClass("greenRows")),prevSelectRow=n),n.hasClass("redsRows")&&n.hasClass("k-state-selected")&&(n.removeClass("redsRows"),prevSelectRow&&(prevSelectRow.attr("id")!="rows_alarm_red"||prevSelectRow.hasClass("k-state-selected")?prevSelectRow.attr("id")!="rows_alarm_green"||prevSelectRow.hasClass("k-state-selected")||prevSelectRow.addClass("greenRows"):prevSelectRow.addClass("redsRows")),prevSelectRow=n),prevSelectRow&&(prevSelectRow.attr("id")!="rows_alarm_green"||prevSelectRow.hasClass("k-state-selected")||prevSelectRow.addClass("greenRows"),prevSelectRow.attr("id")!="rows_alarm_red"||prevSelectRow.hasClass("k-state-selected")||prevSelectRow.addClass("redsRows")),i=$("#tabstrip").data("kendoTabStrip").tabGroup[0].children,statusMod=selectrow.STATUS_DEMAND!=undefined&&statusEnd.indexOf(selectrow.STATUS_DEMAND)==-1,t=0;t<i.length;t++)if($(i[t]).hasClass("k-state-active")&&$(i[t]).attr("data-grid")=="dsEmployee"&&showExtPane){dsEmployee.read({nomer_demand:selectrow.NOMER_DEMAND});break}else if($(i[t]).hasClass("k-state-active")&&$(i[t]).attr("data-grid")=="dsDocs"&&showExtPane){dsDocs.read({demand:selectrow.NOMER_DEMAND});break}else $(i[t]).hasClass("k-state-active")&&$(i[t]).attr("data-grid")=="dsMatching"&&showExtPane&&FillInGridMatching()},culture:"ru-RU",sortable:!0,pageable:{numeric:!1,previousNext:!1},editable:!1,selectable:!0,scrollable:{endless:!0},columnMenu:!1,filterable:!0,filterMenuOpen:function(n){var t,i,r;n.field!="NOTE"&&n.field!="NOTE_COMMENT"&&n.field!="DATE_BEGIN"&&n.field!="DATE_CREATE"&&n.field!="DATE_PLAN_END"&&n.field!="DATE_PLAN_BEGIN"&&n.field!="DAY_PLAN_END"&&n.field!="NAME_RECEIVER"&&n.field!="CL_PHONE"&&n.field!="NAME_OBJECT_KUPSO"&&(t=this.thead.find("[data-field="+n.field+"]").data("kendoFilterMultiCheck"),i=new kendo.data.DataSource(this.dataSource.options),i.data(this.dataSource.data()),this.dataSource.filter()&&i.filter(this.dataSource._filter.filters),i.group(null),r=t.container.find("[type=checkbox]:checked"),t.container.empty(),t.checkSource.data(distinctArr(i.view(),n.field)),t.createCheckBoxes(),t.container.find("[value='"+$(r).val()+"']").prop("checked",!0))},columns:columns,dataBound:function(n){for(var o=n.sender.tbody.children(),i,r,u,f,e,s,h,t=0;t<o.length;t++)i=$(o[t]),r=n.sender.dataItem(i),r.get("ALARM")==1?(i.addClass("redsRows"),i.attr("id","rows_alarm_red")):r.get("ALARM")==3&&(i.addClass("greenRows"),i.attr("id","rows_alarm_green")),r.get("TYPE_MASTER_DEMAND")>0&&i.addClass("boldRows");if(u=dsRefresh.view(),f=n.sender.dataSource.data(),u.length>0)for(e=0;e<u.length;e++)for(t=0;t<f.length;t++)f[t].ID_DEMAND==u[e].ID_DEMAND&&(s=$("#grid").data("kendoGrid").tbody.find("tr[data-uid='"+f[t].uid+"']"),s.addClass("newRows"));toPaintRow(n.sender.dataSource.view(),n);($("#NOMER_DEMAND").val()|dmRep_070.search)==0&&(h=this,$(".k-grouping-row").each(function(){h.collapseGroup(this)}),returnStateGroup())},excelExport:function(n){n.preventDefault();ExcelExport(n.sender.dataSource,bagModel.Title+".xlsx",function(){kendo.ui.progress($("#grid"),!0)},function(){kendo.ui.progress($("#grid"),!1)},null,"#grid",null,null,2.5)}}).data("kendoGrid");$("#grid").kendoTooltip({filter:".note",autoHide:!1,showOn:"click",content:function(n){var t=$("#grid").data("kendoGrid").dataItem(n.target.closest("tr")),i=jqService("/api/Demands/DemandInfo",{IdDemand:t.ID_DEMAND,type:1}),r=jqService("/api/Demands/DemandInfo",{IdDemand:t.ID_DEMAND,type:6}),f=jqService("/api/ClientInfo",{IdClient:t.ID_CLIENT,type:9}),e=jqService("/api/ClientInfo",{IdClient:t.ID_CLIENT,type:2}),u=jqService("/api/ClientInfo",{IdClient:t.ID_CLIENT,type:1}),o=jqService("/api/ClientInfo",{IdClient:t.ID_CLIENT,type:20});return"<div class='hint'><p><b>Клиент:<\/b> "+f+"<\/p><p><b>Телефон:<\/b> "+e+"<\/p><p><b>E-Mail:<\/b> <a href=mailto:"+u+">"+u+"<\/a><\/p><p><b>КЕ:<\/b> "+t.NAME_OBJECT_KUPSO+"<\/p><p><b>Размещение КЕ:<\/b> "+o+"<\/p><p><b>Описание заявки:<\/b> "+(i!="null"?i:"")+"<\/p><p><b>Решение/комментарий к НЗ:<\/b> "+(r!="null"?r:"")+"<\/p><\/div>"}}).data("kendoTooltip");$("#grid").kendoTooltip({filter:".icon_status_other",autoHide:!1,position:"left",showOn:"click",content:function(n){var r=$("#grid").data("kendoGrid").dataItem(n.target.closest("tr")),i=jqService("/odata/NzFromDemand",{nomer_demand:r.NOMER_DEMAND,$filter:"ID_DEMAND ne "+r.ID_DEMAND}),u="<div class='hint' style='width:700px;'><table style='width:100%;'><th style='text-align:center;'>Статус<\/th><th style='text-align:center;'>Дата<\/th><th style='text-align:center;'>Команда<\/th><th style='text-align:center;'>Исполнитель<\/th><th style='text-align:center;'>Решение<\/th><th style='text-align:center;'><\/th>",t;if(i.value.length>0)for(t=0;t<i.value.length;t++)u+=" <tr><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'><span class='k-icon "+i.value[t].STATUS_DEMAND_TXT+"' title='"+i.value[t].STATUS_DEMAND+"'><\/span><\/td><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'>"+kendo.format("{0:dd.MM.yy HH:mm}",new Date(i.value[t].DATE_CREATE))+"<\/td><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'>"+i.value[t].NAME_TEAM+"<\/td><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'>"+i.value[t].NAME_PERFORMER+"<\/td><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'>"+(i.value[t].NOTE_COMMENT==null?"":i.value[t].NOTE_COMMENT)+"<\/td>",u+=t==0?"<td style='text-align:center; padding:5px 5px 0px 5px;' rowspan='"+i.value.length+"'><span id='newNZ' class='k-icon k-i-plus-circle' title='Выдать новый н.з.' style='cursor:pointer;' onClick = 'newNZ("+r.ID_DEMAND+")'><\/span><\/td><\/tr>":"<\/tr>";return u+"<\/table><\/div>"}}).data("kendoTooltip");tooltip=$("#grid").kendoTooltip({filter:"#gridQuestion",autoHide:!1,position:"left",showOn:"click",content:function(n){var u=$("#grid").data("kendoGrid").dataItem(n.target.closest("tr")),i=jqService("/odata/NzFromDemandClient",{nomer_demand:u.NOMER_DEMAND,type_close:39779,$filter:"ID_PERFORMER eq "+u.ID_PERFORMER}),r="<div class='hint' style='width:700px;'><table style='width:100%;'><th style='text-align:center;'>Статус<\/th><th style='text-align:center;'>Дата<\/th><th style='text-align:center;'>Команда<\/th><th style='text-align:center;'>Исполнитель<\/th><th style='text-align:center;'>Вопрос<\/th><th style='text-align:center;'>Ответ клиента<\/th>",t;if(i.value.length>0)for(t=0;t<i.value.length;t++)r+=" <tr><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'><span class='k-icon "+i.value[t].STATUS_DEMAND_TXT+"' title='"+i.value[t].STATUS_DEMAND+"'><\/span><\/td><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'>"+kendo.format("{0:dd.MM.yy HH:mm}",new Date(i.value[t].DATE_CREATE))+"<\/td><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'>"+i.value[t].NAME_TEAM+"<\/td><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'>"+i.value[t].NAME_PERFORMER+"<\/td><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'>"+(i.value[t].NOTE_COMMENT==null?"":i.value[t].NOTE_COMMENT)+"<\/td><td style='text-align:center; padding:5px 5px 0px 5px; border-right:1px solid #ccc'>"+(i.value[t].CLIENT_ANSWER==null?"":i.value[t].CLIENT_ANSWER)+"<\/td>",r+=t==0?"<\/tr>":"<\/tr>";return r+"<\/table><\/div>"}}).data("kendoTooltip");$("#grid").on("click","#icon_status",l);$("#grid").on("click","#linkToRIMS",h);$("#grid").on("click","#icon_docs",p);$("#grid").on("click","#icon_solution",w);$("#grid").on("click","#questionsAndAnswers",showQuestionsAndAnswers);$("#grid").on("click","#NOM_DEMAND",v);$("#grid").on("click","#NOM_DEMAND_HIST",a);$("#grid").on("click","#TEAM",y);$("#grid").on("click","#comment",b);$("#grid").on("click","#linkToRIMS",function(){var n=document.createElement("input");n.setAttribute("value",$(".k-state-selected td #NOM_DEMAND").text());document.body.appendChild(n);n.select();document.execCommand("copy");document.body.removeChild(n)});$("#grid").on("change","#chkNZ",function(n){var r=$("#grid").data("kendoGrid"),i=r.dataItem($(n.currentTarget).closest("tr")),t=$("#gridMenu").data("kendoContextMenu");$(this).prop("checked")?(arrNZ.push({ID_DEMAND:i.ID_DEMAND,ID_TEMPL:i.CHECK_NZ}),arrNZ.length>1&&(t.enable($("#massCloseNZ").parent().parent()[0],!0),t.enable($("#massNextStatus").parent().parent()[0],!0))):(arrNZ.splice(arrNZ.map(function(n){return n.ID_DEMAND}).indexOf(i.ID_DEMAND),1),arrNZ.length<=1&&(t.enable($("#massCloseNZ").parent().parent()[0],!1),t.enable($("#massNextStatus").parent().parent()[0],!1)))});gridNZ=$("#grid2").kendoGrid({groupable:!1,autoBind:!1,dataSource:dsEmployee,culture:"ru-RU",sortable:!1,pageable:{numeric:!1,previousNext:!1},editable:!1,selectable:!0,scrollable:{endless:!0},filterable:!1,columns:[{field:"DATE_CREATE",title:"Дата",format:"{0:dd.MM.yy HH:mm}",timeFormat:"HH:mm",width:45},{field:"NAME_CREATOR",title:"Кем выдано",width:35},{field:"NAME_TEAM",title:"Команда",format:"{0:dd.MM.yy HH:mm}",timeFormat:"HH:mm",width:45},{field:"NAME_PERFORMER",title:"Исполнитель",format:"{0:dd.MM.yy HH:mm}",timeFormat:"HH:mm",width:45},{field:"NOTE_COMMENT",title:"Комментарий/решение",width:150,template:"<div style='display: block; position: relative; cursor:pointer;' ><div style='width:100%;' title='Уточнение информации' id='NOTE_COM'>#= (NOTE_COMMENT ? NOTE_COMMENT : '&nbsp; &nbsp; &nbsp; &nbsp;') #<\/div><\/div>"},{field:"ID_DEMAND",title:"Вып. работы",width:50,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto; cursor:pointer;' ><div style='margin:auto;' title='Добавить выполненные работы/этапы'><span class='k-icon k-i-track-changes-accept icon-color'  id='icon_solution'><\/span><\/div><\/div>"},{field:"STATUS_DEMAND_TXT",title:"Статус",width:50,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto; cursor:pointer;' ><div style='margin:auto;' title='Сменить статус'><span class='k-icon icon-color #:data.STATUS_DEMAND_TXT# ' id='icon_status'><\/span><\/div><\/div>"}]}).data("kendoGrid");gridDocs=$("#DOCS").kendoGrid({groupable:!1,toolbar:[{template:kendo.template($("#templateDocs").html())}],autoBind:!1,dataSource:dsDocs,culture:"ru-RU",sortable:!1,pageable:{numeric:!1,previousNext:!1},editable:!1,selectable:!0,scrollable:{endless:!1},filterable:{extra:!1},change:function(){for(var t=$("td #icon_delete"),i,n=0;n<t.length;n++)checkDelete(this.dataItem($(t[n]).closest("tr")))?$(t[n]).css("color",colorDeleteNoActive):$(t[n]).css("color",colorNoDelete);i=this.dataItem(this.select().closest("tr"));i&&(id_doc=i.ID_DOC,span_delete=$(".k-state-selected td #icon_delete"),checkDelete(i)?span_delete.css({"pointer-events":"auto",color:colorDeleteActive}):span_delete.css({"pointer-events":"none",color:colorNoDelete}))},columns:[{field:"DATE_CREATE",title:"<span style='font-weight:500;'>Дата учета<\/span>",format:"{0:dd.MM.yy HH:mm}",timeFormat:"HH:mm",filterable:!1,width:50},{field:"NOTE",title:"<span style='font-weight:500;'>Описание<\/span>",filterable:!1,width:150},{field:"TYPE_CLOSE",title:"<span style='font-weight:500;'>Решение клиенту<\/span>",filterable:!1,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto;' ><input name='chkTypeClose' class='chk' type='checkbox' data-bind='checked: #= TYPE_CLOSE == type_close ? '1' : '0' #' #= (TYPE_CLOSE == type_close ? 'checked' : '') # style=\"width:16px; height:16px; margin: auto;\"/><\/div>",width:50},{field:"NAME_CREATOR",title:"<span style='font-weight:500;'>Создатель<\/span>",filterable:!1,width:50},{field:"ID_DOC",title:"<span style='font-weight:500;'>Скачать<\/span>",filterable:!1,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto;' ><div style='display:flex;margin:auto;'><a href=\""+serviceRoot+'/api/DocBody?pIdDoc=#=ID_DOC#&FILE_EXT=#=FILE_EXT#"><img src="'+actionContent+'/web/ExtFile/#: data.FILE_EXT.split(".").pop()#.png" onerror="this.onerror=null;this.src=\''+actionContent+'/web/ExtFile/общ.png\';" style="max-width:24px;"/><\/a><\/div><\/div>',width:50},{field:"STATUS_DEMAND_TXT",title:"&nbsp;",filterable:!1,width:30,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto; cursor:pointer;' ><div style='margin:auto;' title='Удалить документ'><span class='k-icon icon-color k-i-delete' id='icon_delete' style='font-size:24px; color:#= checkDelete(data) ? colorDeleteNoActive : colorNoDelete #;'><\/span><\/div><\/div>"}]}).data("kendoGrid");gridMatching=$("#Matching").kendoGrid({groupable:!1,autoBind:!1,dataSource:[],culture:"ru-RU",sortable:!1,pageable:{numeric:!1,previousNext:!1},editable:!1,selectable:!0,scrollable:{endless:!1},filterable:{extra:!1},columns:[{field:"DATE_CREATE",title:"<span style='font-weight:500;'>Дата согласования<\/span>",template:"#= GetDate(new Date(DATE_CREATE)) #",filterable:!1,width:"50px"},{field:"NAME",title:"<span style='font-weight:500;'>ФИО Согласующего<\/span>",filterable:!1,width:50},{field:"COMMENT",title:"<span style='font-weight:500;'>Комментарий<\/span>",filterable:!1,width:150},{field:"FILES",title:"<span style='font-weight:500;'>Файл<\/span>",filterable:!1,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto;' >#=createListFiles(FILES)#<\/div>",width:50}]}).data("kendoGrid");gridDocs.tbody.on("change",".chk",function(n){var r=$(n.target).closest("tr"),t=gridDocs.dataItem(r),i=$("#DOCS");kendo.ui.progress(i,!0);uploadData.ID_DOC=t.ID_DOC;uploadData.NOMER_DEMAND=t.NOMER_DEMAND;uploadData.DATE_CREATE=new Date(t.DATE_CREATE).toJSON();uploadData.FILE_EXT=t.FILE_EXT;uploadData.NOTE=t.NOTE;uploadData.ID_CREATOR=t.ID_CREATOR;this.checked?(uploadData.TYPE_CLOSE=type_close,jqService("/odata/DemandDocs",uploadData,"POST",!0,function(){kendo.ui.progress(i,!1)})):(uploadData.TYPE_CLOSE=0,jqService("/odata/DemandDocs",uploadData,"POST",!0,function(){kendo.ui.progress(i,!1)}))});$("#DOCS").on("click","#icon_delete",c);upload=$("#files").kendoUpload({async:{saveUrl:serviceToolsUrl+"/Upload/save?Data="+JSON.stringify(uploadData),autoUpload:!0},localization:{select:"Выбрать...",dropFilesHere:"Или переместите требуемый документ в область таблицы"},upload:e,complete:o,dropZone:"#DOCS"}).data("kendoUpload");s=$("#dlgImages").kendoWindow({actions:["Close"],visible:!1,closable:!0,modal:!0,open:function(){$(".k-window-title").prepend('<span class="k-icon k-i-gear"><\/span>')},iframe:!0,animation:{open:{effects:"fade:in"},close:{effects:"fade:out"}}});d_end=$("#D_END").kendoDatePicker({culture:"ru-RU",format:"dd.MM.yy",value:new Date,change:setContractMinEnd}).data("kendoDatePicker");d_begin=$("#D_BEGIN").kendoDatePicker({culture:"ru-RU",format:"dd.MM.yy",value:setStartDate($("#D_END").data("kendoDatePicker").value(),Math.abs(cProfilePeriod)*-1),change:setContractMinEnd}).data("kendoDatePicker");$("#filterBtn").kendoButton({imageUrl:actionImages+"/refresh.png",click:function(){SetFilter();cProfileRefreshInt&&cProfileRefreshInt>0&&refreshGridInterval()}});$("#expandAll").kendoButton({icon:"zoom-in",click:function(){var n=$("#grid").data("kendoGrid");$(".k-grouping-row").each(function(){n.expandRow(this)})}});$("#collapseAll").kendoButton({icon:"zoom-out",click:function(){var n=$("#grid").data("kendoGrid");$(".k-grouping-row").each(function(){n.collapseRow(this)})}});$("#help").kendoButton({click:function(){window.open(helpURL+$(location).attr("search"))}});var t=$("#date-switch").kendoMobileSwitch({onLabel:"Вкл",offLabel:"Откл",change:function(t){var u,r;if(i.current().index()!=1&&n.select(0),u=n.element[0].getElementsByTagName("span"),t.checked==!1)for(statusNew=Number(i.current()[0].getAttribute("data-value"))+10,d_begin.enable(!1),d_end.enable(!1),r=0;r<u.length;r++)u[r].getAttribute("data-status")==0&&$(u[r]).addClass("k-state-disabled");else for(statusNew=null,d_begin.enable(!0),d_end.enable(!0),r=0;r<u.length;r++)i.current().index()==2?u[r].getAttribute("data-status")==0&&$(u[r]).addClass("k-state-disabled"):u[r].getAttribute("data-status")==0&&$(u[r]).removeClass("k-state-disabled")}}).data("kendoMobileSwitch"),n=$("#STATUS_EXT").kendoButtonGroup({select:function(){this.current().index()!=0?(r.enable(!1),r.select(2)):(r.enable(!0),r.select(2))}}).data("kendoButtonGroup"),r=$("#STATUS_3").kendoButtonGroup({select:function(){setTimeout(function(){SetFilter();cProfileRefreshInt&&cProfileRefreshInt>0&&refreshGridInterval()},500)}}).data("kendoButtonGroup"),i=$("#STATUS").kendoButtonGroup({index:2,select:function(){var r,i;if(statusNew=t.check()==!1?Number(this.current()[0].getAttribute("data-value"))+10:this.current()[0].getAttribute("data-value"),r=n.element[0].getElementsByTagName("span"),this.current().index()==0){for(i=0;i<r.length;i++)r[i].getAttribute("data-status")==0&&$(r[i]).addClass("k-state-disabled");n.select(0);n.enable(!0);t.check(!1);d_begin.enable(!1);d_end.enable(!1);statusNew=Number(this.current()[0].getAttribute("data-value"))+10}else if(this.current().index()==1)n.select(3),n.enable(!1),t.check(!1),d_begin.enable(!1),d_end.enable(!1),statusNew=Number(this.current()[0].getAttribute("data-value"))+10;else if(this.current().index()==2){for(i=0;i<r.length;i++)r[i].getAttribute("data-status")==0&&$(r[i]).addClass("k-state-disabled");n.select(0);n.enable(!0);t.check(!1);d_begin.enable(!1);d_end.enable(!1);statusNew=Number(this.current()[0].getAttribute("data-value"))+10}else if(this.current().index()==3){for(i=0;i<r.length;i++)r[i].getAttribute("data-status")==0&&$(r[i]).addClass("k-state-disabled");n.enable(!0);n.select(0);t.check(!1);d_begin.enable(!1);d_end.enable(!1);statusNew=Number(this.current()[0].getAttribute("data-value"))+10}}}).data("kendoButtonGroup");pb=$("#loadingProgressBar").kendoProgressBar({showStatus:!1,animation:!1,max:cProfileRefreshInt/1e3}).data("kendoProgressBar");cProfileRefreshInt&&cProfileRefreshInt>0&&$("#loadingProgressBar").css({display:"block"});$("#NOMER_DEMAND").keyup(function(n){var t=$("#NOMER_DEMAND");n.keyCode==13&&SetFilter()});$("#NOMER_DEMAND").focus(function(){t.enable(!1);d_end.enable(!1);d_begin.enable(!1);i.enable(!1);n.enable(!1)});$("#NOMER_DEMAND").blur(function(){var r=$("#NOMER_DEMAND");r.val()||(t.enable(!0),d_end.enable(!0),d_begin.enable(!0),i.enable(!0),n.enable(!0))});dmRep_070.search&&(t.enable(!1),d_end.enable(!1),d_begin.enable(!1),i.enable(!1),n.enable(!1),SetFilter());cProfileRefreshInt&&cProfileRefreshInt>0&&setInterval(function(){idleTime=idleTime+1;idleTime==30&&idleTime<31&&(clearInterval(refreshBar),clearTimeout(intervalID),$("#filterBtn").addClass("refBtn"),spawnNotification("Информация - "+bagModel.Title,"Произошло отключение автоматического обновления, для повторного запуска нажмите кнопку «Обновить»","/Content/web/Status/В ожидании.png"))},6e4);$(this).mousemove(function(){idleTime=0});$(this).keypress(function(){idleTime=0})});var STATUS=[{title:"Задания назначенные на текущего исполнителя",caption:"Мои задания",value:0},{title:"Задания по моим командам без назначенного исполнителя",caption:"Не назначено",value:2},{title:"Активные",caption:"Мои задания + не назначено",value:3},{title:"Все задания по моим командам",caption:"Все задания",value:1}],STATUS_EXT=[{title:"Н.з.выдан, Н.з.выполняется, Н.з.в ожидании",caption:"Активные",value:0,status:1},{title:"Н.з.запланирован",caption:"Запланирован",value:1,status:1},{title:"Н.з.выполнен, Н.з.отклонен",caption:"Закрытые",value:2,status:0},{title:"Н.з.выдан, Н.з.выполняется, Н.з.в ожидании, Н.з.запланирован, Н.з.выполнен, Н.з.отклонен",caption:"Все статусы",value:3,status:0}],STATUS_3=[{title:"Н.з.выдан, Н.з.выполняется",caption:"В работе",value:0},{title:"Н.з. в ожидании",caption:"Ожидание",value:1},{title:"Н.з. выдано, Н.з. выполняется, Н.з. в Ожидании",caption:"Все",value:2}],dsContextMenu=[{keyToConfigure:"001",text:"<span data-code='1'><span class='k-icon k-i-copy'><\/span>Перевод статуса<\/span>",encoded:!1},{keyToConfigure:"020",text:"<span data-code='20'><span class='k-icon k-i-track-changes-accept'><\/span>Работы по НЗ<\/span>",encoded:!1,items:[]},{keyToConfigure:"002",text:"<span data-code='2'><span class='k-icon k-i-track-changes-accept'><\/span>Добавление/Просмотр ВР<\/span>",encoded:!1},{keyToConfigure:"017",text:"<span data-code='17' id='addCompletedWork'><span class='k-icon k-i-track-changes-accept'><\/span>Добавить ВР<\/span>",encoded:!1},{keyToConfigure:"022",text:"<span data-code='22' id='massNextStatus'><span class='k-icon k-i-sub-script'><\/span>Перевести в работу несколько НЗ<\/span>",encoded:!1},{keyToConfigure:"003",text:"<span data-code='30' id='accessCloseNZ'><span class='k-icon k-i-track-changes-reject'><\/span>Закрыть н.з. по шаблону<\/span>",encoded:!1,items:[]},{keyToConfigure:"014",text:"<span data-code='14' id='assognPerformer'><span class='k-icon k-i-track-changes-enable'><\/span>Назначить исполнителя<\/span>",encoded:!1,items:[]},{keyToConfigure:"015",text:"<span id='changeServices'><span class='k-icon k-i-track-changes-enable'><\/span>Редактирование<\/span>",encoded:!1,items:[{text:"<span data-code='151' id='changeServices'><span class='k-icon k-i-track-changes-enable'><\/span>Изменить каталог сервисов<\/span>",encoded:!1},{text:"<span data-code='152'><span class='k-icon k-i-track-changes-enable'><\/span>Добавить “ОЕ”<\/span>",encoded:!1},{text:"<span data-code='153'><span class='k-icon k-i-track-changes-enable'><\/span>Типы проблем<\/span>",encoded:!1},{text:"<span data-code='154' id='changeCloseStatus'><span class='k-icon k-i-track-changes-enable'><\/span>Уточняющий статус<\/span>",encoded:!1}]},{keyToConfigure:"004",text:"<span data-code='4'><span class='k-icon k-i-track-changes-enable'><\/span>Выдать новый н.з<\/span>",encoded:!1},{keyToConfigure:"005",text:"<span data-code='5'><span class='k-icon k-i-paste-plain-text'><\/span>Информация по заявке<\/span>",encoded:!1},{keyToConfigure:"006",text:"<span data-code='6'><span class='k-icon k-i-attachment'><\/span>Добавление/Просмотр документов<\/span>",encoded:!1},{keyToConfigure:"007",text:"<span data-code='7'><span class='k-icon k-i-calculator'><\/span>Назначить норму НЗ<\/span>",encoded:!1},{keyToConfigure:"008",text:"<span data-code='8'><span class='k-icon k-i-sort-asc'><\/span>Структура заявки<\/span>",encoded:!1},{keyToConfigure:"009",text:"<span data-code='9'><span class='k-icon k-i-edit-tools'><\/span>Комментарии/уточнения<\/span>",encoded:!1},{keyToConfigure:"013",text:"<span data-code='13' id='postponementSLA'><span class='k-icon k-i-gears'><\/span>Перенос срока SLA<\/span>",encoded:!1},{keyToConfigure:"010",text:"<span data-code='10' id='accessTMC'><span class='k-icon k-i-gears'><\/span>Добавление/Просмотр ТМЦ<\/span>",encoded:!1},{keyToConfigure:"011",text:"<span data-code='11' id='accessCreateTemp'><span class='k-icon k-i-track-changes-accept'><\/span>Создать заявку по шаблону<\/span>",encoded:!1},{keyToConfigure:"012",text:"<span data-code='12' id='accessCreateTemp'><span class='k-icon k-i-track-changes-accept'><\/span>Создать заявку на согласование<\/span>",encoded:!1},{keyToConfigure:"016",text:"<span><span class='k-icon k-i-copy'><\/span>Копировать в буфер обмена<\/span>",encoded:!1,items:[{text:"<span data-code='161'><span class='k-icon k-i-copy'><\/span>N заявки<\/span>",encoded:!1},{text:"<span data-code='162'><span class='k-icon k-i-copy'><\/span>Описание заявки<\/span>",encoded:!1},{text:"<span data-code='163'><span class='k-icon k-i-copy'><\/span>ФИО Клиента<\/span>",encoded:!1},{text:"<span data-code='164'><span class='k-icon k-i-copy'><\/span>Решение комментарии<\/span>",encoded:!1},{text:"<span data-code='165'><span class='k-icon k-i-copy'><\/span>URL<\/span>",encoded:!1},{text:"<span data-code='166'><span class='k-icon k-i-copy'><\/span>Общую инф-ю<\/span>",encoded:!1}]},{keyToConfigure:"018",text:"<span data-code='18' id='massCloseNZ'><span class='k-icon k-i-sub-script'><\/span>Закрыть несколько НЗ<\/span>",encoded:!1},{keyToConfigure:"019",text:"<span><span class='k-icon k-i-copy'><\/span>Акты/Карточки<\/span>",encoded:!1,items:[{text:"<span data-code='191'><span class='k-icon k-i-copy'><\/span>Акт установки расходных материалов и комплектующих<\/span>",encoded:!1},{text:"<span data-code='192'><span class='k-icon k-i-copy'><\/span>Акт технического состояния из шаблона<\/span>",encoded:!1},{text:"<span data-code='193' id='VamiFD01'><span class='k-icon k-i-copy'><\/span>Служебная VAMI-ФД-01<\/span>",encoded:!1},]},{keyToConfigure:"021",text:"<span data-code='21' id='StatusExecTrans'><span class='k-icon k-i-check-outline'><\/span>Решение по перевозке<\/span>",encoded:!1},{keyToConfigure:"023",text:"<span data-code='23' id='approveTransferOfTerm'><span class='k-icon k-i-check-outline'><\/span>Согласовать перенос срока<\/span>",encoded:!1},],dsCopyContextMenu=[{keyToConfigure:"001",text:"<span data-code='1'><span class='k-icon k-i-copy'><\/span>Копировать N заявки<\/span>",encoded:!1},{keyToConfigure:"002",text:"<span data-code='2'><span class='k-icon k-i-copy'><\/span>Коп. описание заявки<\/span>",encoded:!1},{keyToConfigure:"003",text:"<span data-code='3'><span class='k-icon k-i-copy'><\/span>Коп. ФИО Клиента<\/span>",encoded:!1},{keyToConfigure:"004",text:"<span data-code='4'><span class='k-icon k-i-copy'><\/span>Коп. решение комментарии<\/span>",encoded:!1},{keyToConfigure:"005",text:"<span data-code='5'><span class='k-icon k-i-copy'><\/span>Коп. URL<\/span>",encoded:!1},{keyToConfigure:"006",text:"<span data-code='6'><span class='k-icon k-i-copy'><\/span>Коп. общую инф-ю<\/span>",encoded:!1},],fileredContextItems=[];dsContextMenu.forEach(function(n){cProfileContextMenu.indexOf(n.keyToConfigure)!=-1&&fileredContextItems.push(n)});dsContextMenu=fileredContextItems;columns=[{hidden:IsColumnHidden("NOMER_DEMAND"),field:"NOMER_DEMAND",title:"№",attributes:{"data-CopyMenu":"true"},headerAttributes:{title:"№ заявки"},filterable:!1,groupable:!1,width:23*k,template:"<div id='NOM_DEMAND' style='cursor:pointer;' title='Информация по заявке'>#:data.NOMER_DEMAND#<\/div>"},{hidden:IsColumnHidden("NOMER_DEMAND_HIST"),field:"NOMER_DEMAND_HIST",title:"№",attributes:{"data-CopyMenu":"true"},headerAttributes:{title:"№ заявки"},filterable:!1,groupable:!1,width:23*k,template:"<div id='NOM_DEMAND_HIST' style='cursor:pointer;' title='Информация по заявке'>#:data.NOMER_DEMAND_HIST#<\/div>"},{hidden:IsColumnHidden("COUNT_VR"),field:"COUNT_VR",title:"Вып.",headerAttributes:{title:"Выполненные работы"},filterable:!1,groupable:!1,width:15*k,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto; cursor:pointer;' ><div style='margin:auto;' title='Добавить выполненные работы/этапы'><span class='k-icon k-i-track-changes-accept icon-color'  id='icon_solution'><\/span><\/div><\/div>"},{hidden:IsColumnHidden("DOCS"),field:"DOCS",title:"Док-ты",headerAttributes:{title:"Документы"},filterable:!1,editable:!1,groupable:!1,width:20*k,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto; cursor:pointer;' ><div style='margin:auto;' title='Просмотр/Добавление документов'><span class='k-icon k-i-attachment icon-color' id='icon_docs'><\/span><sup style='font-size:9px;'>#:data.DOCS# <\/sup><\/div><\/div>"},{hidden:IsColumnHidden("DATE_BEGIN"),field:"DATE_BEGIN",title:"Выдан",headerAttributes:{title:"Дата выдачи"},dataType:"date",template:"<span title='Дата выдачи наряд-задания'>#= DATE_BEGIN ? kendo.format('{0:dd.MM.yy HH:mm}', DATE_BEGIN):''#<\/span>",width:30*k},{hidden:IsColumnHidden("STATUS_DEMAND"),field:"STATUS_DEMAND",title:"Статус",headerAttributes:{title:"Статус"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},width:30*k,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto; cursor:pointer;' ><div style='margin:auto;' title='#=data.STATUS_DEMAND#'><span class='k-icon icon-color #:data.STATUS_DEMAND_TXT# ' id='icon_status'><\/span><\/div><\/div>"},{hidden:IsColumnHidden("TYPE_MASTER_DEMAND"),field:"TYPE_MASTER_DEMAND",title:"Осн.Н.З.",headerAttributes:{title:"Основное наряд-задание"},filterable:!1,width:20*k,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto;' ><input id='msdemand' type='checkbox' disabled='true' #=(TYPE_MASTER_DEMAND != null && TYPE_MASTER_DEMAND != 0 ? 'checked' : '')# style=\"width:16px; height:16px; margin: auto;\"/><\/div>"},{hidden:IsColumnHidden("NAME_STATUS_DEMAND"),field:"NAME_STATUS_DEMAND",title:"Приоритет",headerAttributes:{title:"Приоритет"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto;' ><div style='margin:auto;' title='#:data.NAME_STATUS_DEMAND#'><span class='k-icon k-i-warning'style = 'color: #=(KOD_STATUS_DEMAND == 3 || KOD_STATUS_DEMAND == 4 ? 'red;' : (KOD_STATUS_DEMAND == 0 ? '\\#d2d432;' : (KOD_STATUS_DEMAND == 1 ? 'blue;' : 'green;')))# font-size:24px;'><\/span><\/div><\/div>",width:25*k},{hidden:IsColumnHidden("NAME_GROUP_ACCESS"),field:"NAME_GROUP_ACCESS",title:"Локация",headerAttributes:{title:"Локация"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},width:45*k},{hidden:IsColumnHidden("NAME_GROUP_ACCESS_SH"),field:"NAME_GROUP_ACCESS_SH",title:"Локация",headerAttributes:{title:"Локация"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},width:45*k},{hidden:IsColumnHidden("FIO_CREATOR"),field:"FIO_CREATOR",title:"Кем выдан",headerAttributes:{title:"Кем выдан"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},template:"<a href='https://fim.sib.rual.ru/Person/Info?Uid=#= CR_SEARCH_CODE #' target='_blank' class='rims'>#= (CR_SEARCH_CODE != null ? FIO_CREATOR : '') #<\/a>",width:30*k},{hidden:IsColumnHidden("NAME_CLIENT"),field:"NAME_CLIENT",title:"Клиент",headerAttributes:{title:"Клиент"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},template:"#= (CL_SEARCH_CODE != null ? \"<a href='https://fim.sib.rual.ru/Person/Info?Uid=\" + CL_SEARCH_CODE + \"' target='_blank' title='RIMS' id='linkToRIMS'>\" + NAME_CLIENT + \"<\/a>\" : NAME_CLIENT) #",width:30*k},{hidden:IsColumnHidden("DATE_TERMINATION"),field:"DATE_TERMINATION",title:"Дата расторжения ТД",headerAttributes:{title:"Дата расторжения ТД"},width:30*k},{hidden:IsColumnHidden("NAME_CLIENT_NOT_URL"),field:"NAME_CLIENT_NOT_URL",title:"Клиент",headerAttributes:{title:"Клиент"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},template:"<a href='http://phonebook.int.rual.ru/app/WorkInfo.aspx?PersonID=0&WorkID=0&Mail=#= CL_MAIL #' target='_blank' title='Телефонный справочник'> #= NAME_CLIENT_NOT_URL #<\/a>",width:30*k},{hidden:IsColumnHidden("NAME_CLIENT_FULL"),field:"NAME_CLIENT_FULL",title:"Клиент",headerAttributes:{title:"Клиент"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},template:"#= (CL_SEARCH_CODE != null ? \"<a href='https://fim.sib.rual.ru/Person/Info?Uid=\" + CL_SEARCH_CODE + \"' target='_blank' title='RIMS' id='linkToRIMS'>\" + NAME_CLIENT_FULL + \"<\/a>\" : NAME_CLIENT_FULL) #",width:30*k},{hidden:IsColumnHidden("NAME_RECEIVER"),field:"NAME_RECEIVER",title:"ФИО получателя справки",headerAttributes:{title:"ФИО получателя справки"},width:30*k},{hidden:IsColumnHidden("CHECK_NZ"),field:"CHECK_NZ",title:"Выбор",headerAttributes:{title:"Выбор НЗ для массового закрытия"},filterable:!1,template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto;' ><input id='chkNZ' type='checkbox' #=(STATUS_DEMAND != 'н.з. Выдано' ? (CHECK_NZ == null || (STATUS_DEMAND == 'н.з. Выполнено' || STATUS_DEMAND == 'н.з. Отклонено') ? 'disabled style=\"width:16px; height:16px; margin: auto;\"' : 'style=\"width:24px; height:24px; margin: auto;\"') : 'style=\"width:24px; height:24px; margin: auto;\"')#/><\/div>",width:20*k},{hidden:IsColumnHidden("NAME_POSITION"),field:"NAME_POSITION",title:"Должность (подбор персонала)",headerAttributes:{title:"Должность (подбор персонала)"},width:30*k},{hidden:IsColumnHidden("NAME_CLIENT"),field:"CL_PHONE",title:"Тел.",headerAttributes:{title:"Телефон"},template:"<a href='http://phonebook.int.rual.ru/app/WorkInfo.aspx?PersonID=0&WorkID=0&Mail=#= CL_MAIL #' target='_blank' title='Телефонный справочник'>#= (CL_PHONE != null ? CL_PHONE : '') #<\/a>",width:30*k},{hidden:IsColumnHidden("NAME_CLIENT"),field:"CL_MAIL",title:"E-Mail",headerAttributes:{title:"E-Mail"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},template:"<a href='mailto:#= CL_MAIL #' title='Написать'>#= (CL_MAIL != null ? CL_MAIL : '') #<\/a>",width:30*k},{hidden:IsColumnHidden("NAME_CONTRACTOR"),field:"NAME_CONTRACTOR",title:"Контрагент",headerAttributes:{title:"Контрагент"},width:40*k,filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}}},{hidden:IsColumnHidden("ATTR_EXT_01"),field:"ATTR_EXT_01",title:"БЕ",headerAttributes:{title:"БЕ"},width:30*k},{hidden:IsColumnHidden("ATTR_EXT_02"),field:"ATTR_EXT_02",title:"ОЕ",headerAttributes:{title:"ОЕ"},filterable:!0,width:30*k},{hidden:IsColumnHidden("IDEA_NAME"),field:"IDEA_NAME",title:"Название идеи",headerAttributes:{title:"Название идеи"},filterable:!0,width:50*k},{hidden:!0,field:"ROW_COLOR"},{hidden:IsColumnHidden("NAME_TRANZ"),field:"NAME_TRANZ",title:"Транзакция",headerAttributes:{title:"Код и наименование транзакции"},filterable:!1,width:30*k},{hidden:IsColumnHidden("KOD_TEMPLATE_DEMAND"),field:"KOD_TEMPLATE_DEMAND",title:"Код",headerAttributes:{title:"Код шаблона"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},width:30*k},{hidden:IsColumnHidden("NAME_TEMPLATE_DEMAND"),field:"NAME_TEMPLATE_DEMAND",title:"Шаблон",headerAttributes:{title:"Шаблон"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},width:50*k},{hidden:IsColumnHidden("NAME_CATALOG_SERVICES"),field:"NAME_CATALOG_SERVICES",title:"Сервис",headerAttributes:{title:"Сервис"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},width:30*k},{hidden:IsColumnHidden("NAME_GROUP_WORK"),field:"NAME_GROUP_WORK",title:"Тип заявки",headerAttributes:{title:"Тип заявки"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},width:50*k},{hidden:IsColumnHidden("NAME_OBJECT_KUPSO"),field:"NAME_OBJECT_KUPSO",title:"КЕ",headerAttributes:{title:"Конфиг. единица"},filterable:!0,width:60*k},{hidden:IsColumnHidden("NOTE"),field:"NOTE",title:"Описание",headerAttributes:{title:"Описание"},filterable:!0,groupable:!1,template:"<div class='note'>#= NOTE ? NOTE.replace(new RegExp('\\r?\\n', 'g'), ' ').replace(new RegExp('( ){2,}', 'g'), ' ').slice(0,99) + (NOTE.length > 100 ? '...' : '') : NOTE#<\/div>",width:100*k,height:50},{hidden:IsColumnHidden("DATE_CREATE"),field:"DATE_CREATE",title:"Переведен",headerAttributes:{title:"Дата тек. статуса"},dataType:"date",format:"{0:dd.MM.yy HH:mm}",timeFormat:"HH:mm",filterable:!0,width:30*k},{hidden:IsColumnHidden("SLA_LIGHT"),field:"SLA_LIGHT",title:"SLA",headerAttributes:{title:"SLA"},filterable:!1,attributes:{style:"font-weight:700; color:#=(SLA_LIGHT == 0 ? 'red;' : (SLA_LIGHT == 1 ? '\\#d2d432;' : (SLA_LIGHT == 2 ? 'blue;' : 'green;')))#;"},template:"<div style='display: flex; position: relative; margin-left: auto; margin-right: auto;' ><div style='margin:auto;'><span class='fa fa-flag' style='font-size:16px;'><\/span><\/div><\/div>",width:20*k},{hidden:IsColumnHidden("DATE_PLAN_BEGIN"),field:"DATE_PLAN_BEGIN",title:"Пл.начало",headerAttributes:{title:"Дата планового начала"},dataType:"date",format:"{0:dd.MM.yy HH:mm}",timeFormat:"HH:mm",filterable:!0,width:30*k},{hidden:IsColumnHidden("DATE_PLAN_END"),field:"DATE_PLAN_END",title:"Пл.оконч.",headerAttributes:{title:"Дата планового окончания"},dataType:"date",format:"{0:dd.MM.yy HH:mm}",timeFormat:"HH:mm",attributes:{style:"font-weight:700; color:#=(STATUS_DEMAND == 'н.з. Выполнено' || STATUS_DEMAND == 'н.з. Отклонено' ? (DATE_PLAN_END < DATE_CREATE ? 'red' : 'green') : (DATE_PLAN_END < new Date() ? 'red' : 'green'))#;"},filterable:!0,width:20*k},{hidden:IsColumnHidden("DAY_PLAN_END"),field:"DAY_PLAN_END",title:"Ост.дней",headerAttributes:{title:"Осталось дней"},filterable:!0,attributes:{style:"font-weight:700; color:#=(STATUS_DEMAND == 'н.з. Выполнено' || STATUS_DEMAND == 'н.з. Отклонено' ? (DATE_PLAN_END < DATE_CREATE ? 'red' : 'green') : (DATE_PLAN_END < new Date() ? 'red' : 'green'))#;"},width:30*k},{hidden:IsColumnHidden("DAYS_END"),field:"DAYS_END",title:"Ост.дней",headerAttributes:{title:"Осталось дней"},filterable:!1,attributes:{style:"font-weight:700; color:#=(STATUS_DEMAND == 'н.з. Выполнено' || STATUS_DEMAND == 'н.з. Отклонено' ? (DATE_PLAN_END < DATE_CREATE ? 'red' : 'green') : (DATE_PLAN_END < new Date() ? 'red' : 'green'))#;"},width:30*k},{hidden:IsColumnHidden("HOURS_END"),field:"HOURS_END",title:"Ост.часов",headerAttributes:{title:"Осталось часов"},filterable:!1,attributes:{style:"font-weight:700; color:#=(STATUS_DEMAND == 'н.з. Выполнено' || STATUS_DEMAND == 'н.з. Отклонено' ? (DATE_PLAN_END < DATE_CREATE ? 'red' : 'green') : (DATE_PLAN_END < new Date() ? 'red' : 'green'))#;"},width:30*k},{hidden:IsColumnHidden("NORMA_NZ"),field:"NORMA_NZ",title:"Норма ч.час",headerAttributes:{title:"Норма ч.час"},filterable:!1,template:"#=(NORMA_NZ ? translateTime(data.NORMA_NZ) : '')#",width:30*k},{hidden:IsColumnHidden("SHORT_NAME_TEAM"),field:"SHORT_NAME_TEAM",title:"Команда",headerAttributes:{title:"Команда"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},width:40*k,template:"<div id='TEAM' style='cursor:pointer;' title='Информация по заявке'>#:data.SHORT_NAME_TEAM#<\/div>"},{hidden:IsColumnHidden("NAME_TEAM"),field:"NAME_TEAM",title:"Команда",headerAttributes:{title:"Команда"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},width:40*k,template:"<div id='TEAM' style='cursor:pointer;' title='Информация по заявке'>#:data.NAME_TEAM#<\/div>"},{hidden:IsColumnHidden("NAME_PERFORMER"),field:"NAME_PERFORMER",title:"Исполнитель",headerAttributes:{title:"Исполнитель"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},template:"<a href='http://phonebook.int.rual.ru/app/WorkInfo.aspx?PersonID=0&WorkID=0&Mail=#= PERFORMER_EMAIL #' target='_blank' title='Телефонный справочник'>#= (NAME_PERFORMER != null ? NAME_PERFORMER : '') #<\/a>",width:30*k},{hidden:IsColumnHidden("CLIENT_ANSWER"),filterable:!1,groupable:!1,field:"CLIENT_ANSWER",title:"Уточнения",width:40*k,template:"#=(data.CLIENT_ANSWER ? '<div style=\"text-align: center; cursor:pointer;\" id=\"gridQuestion\"><span class=\"k-icon cust-icon-size ' + data.CLIENT_ANSWER + '\"' + (data.CLIENT_ANSWER == 'k-i-warning' ? ' style=\"color:green;\" title=\"Получена уточняющая информация\"' : ' title=\"Запрошена уточняющая информация\"') + '><\/span><\/div>' : '')#"},{hidden:IsColumnHidden("KOD_STATUS_NO"),field:"KOD_STATUS_NO",title:"Статус иных Н.З.",headerAttributes:{title:"Статус иных Н.З."},filterable:!1,template:'#=(data.KOD_STATUS_NO ? \'<div style="display: flex; position: relative; margin-left: auto; margin-right: auto; cursor:pointer;" class="icon_status_other"><div style="margin:auto;"><span class="k-icon icon-color \' + data.KOD_STATUS_NO + \'" id="icon_status_other"><\/span><\/div><\/div>\' : \'\')#',width:30*k},{hidden:IsColumnHidden("LINK_INTERNET"),field:"LINK_INTERNET",title:"URL",headerAttributes:{title:"URL"},groupable:!1,template:"<div style='text-align:center' title='Ссылка на заявку' ><a href='#= LINK_INTERNET #' target='_blank'>#= (LINK_INTERNET != null ? '<span id=\"icon_color\" class=\"k-icon k-i-hyperlink-globe icon-color\"><\/span>' : '') #<\/a><\/div>",filterable:!1,width:20*k},{hidden:IsColumnHidden("COUNT_MATERIAL"),field:"COUNT_MATERIAL",title:"Категория",headerAttributes:{title:"Категория"},groupable:!0,groupHeaderTemplate:"<span class='name_group' data-uid='#:data.uid#' data-field='#:data.field#'>#=(data.value == null ? 'Отсутствует' : colurList.filter(function(e){ return e.Id == data.value })[0].Name ) #<\/span>: #= count #",template:"<div class='countMaterialContent'><div class='countMaterialOrb #= (COUNT_MATERIAL == null ? typeof COUNT_MATERIAL : colurList.filter(function(e){ return e.Id == COUNT_MATERIAL })[0].Class)  #'><\/div><\/div>",filterable:!1,width:20*k},{hidden:IsColumnHidden("NAME_CLOSE"),field:"NAME_CLOSE",title:"Доп.статус",headerAttributes:{title:"Доп. статус"},filterable:{multi:!0,messages:{checkAll:"Отметить все",clear:"очистить",filter:"фильтровать",cancel:"отменить",selectedItemsFormat:"{0} элементов выбрано"}},width:30*k},{hidden:IsColumnHidden("NOTE_COMMENT"),field:"NOTE_COMMENT",groupable:!1,title:"Решение/комментарий",headerAttributes:{title:"Решение/комментарий"},filterable:!0,width:75*k,template:"#= (NOTE_COMMENT ? '<div id=\"comment\" style=\"cursor:pointer;\" title=\"Комментарии/уточнения\">'+NOTE_COMMENT.replace(new RegExp('\\r?\\n', 'g'), ' ').replace(new RegExp('( ){2,}', 'g'), ' ').slice(0,99) + (NOTE_COMMENT.length > 100 ? '...' : '')+'<\/div>' : '<div id=\"comment\" style=\"cursor:pointer;\" title=\"Комментарии/уточнения\">                                   <\/div>') #"},{hidden:IsColumnHidden("PORTAL"),field:"PORTAL",title:"Портал",headerAttributes:{title:"Портал"},filterable:!0,width:30*k},{hidden:IsColumnHidden("CARGO"),field:"CARGO",title:"Наименование груза",headerAttributes:{title:"Наименование груза"},filterable:!0,width:60*k}];columns.forEach(function(n){n.groupable!=!1&&(n.aggregates=["count"],typeof n.groupHeaderTemplate=="undefined"&&(n.groupHeaderTemplate=n.dataType=="date"?"<span class='name_group' data-uid='#:data.uid#' data-field='#:data.field#'>#=  kendo.format('{0:dd.MM.yyyy}', data.value) #<\/span>: #= count #":"<span class='name_group' data-uid='#:data.uid#' data-field='#:data.field#'>#=(data.value == null ? 'Отсутствует' : data.value) #<\/span>: #= count #"))});columns.splice(38,0,columnDialogue("data.CLIENT_ANSWER"))